{"version":3,"file":"OData2Client.js","names":["ODataHelper","_interopRequireDefault","__ODataHelper","Util","__Util","OData2Client","constructor","serviceUrl","this","model","ODataModelV2","attachRequestFailed","event","parameters","getParameters","resp+
onseText","response","startsWith","parser","DOMParser","xmlDoc","parseFromString","messageNode","getElementsByTagName","MessageBox","error","textContent","json","JSON","parse","message","value","getActions","destroy","createEntity","options","setHeaders"+
,"headers","Promise","resolve","reject","create","entityName","properties","success","getEntity","path","createKey","keys","context","createBindingContext","undefined","data","Error","getObject","deleteEntity","remove","initAsync","metadataLoaded","detai+
ls","getErrorMessage","metadataText","getMetadataText","metadataXml","parseMetadataXml","getEntities","entities","entitySets","Array","from","map","node","Name","getAttribute","EntityType","entity","entityType","includes","split","pop","entityTypeNode","+
find","propertyNode","name","type","nullable","maxLength","getMaxLength","keyNode","propertyRefs","property","push","filter","getMetadataXml","getFunctions","functionImports","ReturnType","EntitySet","HttpMethod","Parameters","paramNode","func","returnTy+
pe","entitySet","method","getModel","readEntity","read","filters","length","sorters","sorting","urlParameters","$top","top","toString","$skip","skip","executeFunction","callFunction","functionName","executeAction","stringify"],"sources":["OData2Client.ts+
"],"sourcesContent":["import Filter from \"sap/ui/model/Filter\";\nimport IODataClient from \"./IODataClient\";\nimport ODataModel from \"sap/ui/model/odata/ODataModel\";\nimport ODataModelV2 from \"sap/ui/model/odata/v2/ODataModel\";\nimport {\n\tMetada+
taAction,\n\tMetadataEntity,\n\tMetadataFunction,\n\tMetadataFunctionMethod,\n} from \"../Types\";\nimport ODataHelper from \"./ODataHelper\";\nimport Context from \"sap/ui/model/odata/v2/Context\";\nimport { Model$RequestFailedEvent } from \"sap/ui/mode+
l/Model\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport Sorter from \"sap/ui/model/Sorter\";\nimport Util from \"./Util\";\n\n/**\n * @namespace de.kernich.odpu.util\n */\nexport default class OData2Client implements IODataClient {\n\tprivate mo+
del: ODataModelV2;\n\tprivate serviceUrl: string;\n\tprivate metadataText: string;\n\tprivate metadataXml: XMLDocument;\n\n\tconstructor(serviceUrl: string) {\n\t\tthis.serviceUrl = serviceUrl;\n\t\tthis.model = new ODataModelV2(serviceUrl, {});\n\n\t\tt+
his.model.attachRequestFailed({}, (event: Model$RequestFailedEvent) => {\n\t\t\tconst parameters = event.getParameters() as {\n\t\t\t\tresponse: {\n\t\t\t\t\tresponseText: string;\n\t\t\t\t};\n\t\t\t};\n\t\t\tconst responseText = parameters.response.resp+
onseText;\n\n\t\t\tif (responseText.startsWith(\"<?xml\")) {\n\t\t\t\t// Handle XML response\n\t\t\t\tconst parser = new DOMParser();\n\t\t\t\tconst xmlDoc = parser.parseFromString(responseText, \"text/xml\");\n\t\t\t\tconst messageNode = xmlDoc.getEleme+
ntsByTagName(\"message\")[0];\n\t\t\t\tif (messageNode) {\n\t\t\t\t\tMessageBox.error(messageNode.textContent);\n\t\t\t\t} else {\n\t\t\t\t\tMessageBox.error(\"Unknown error occurred\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Handle JSON response\n\t\t\t+
\tconst json = JSON.parse(responseText) as {\n\t\t\t\t\terror: {\n\t\t\t\t\t\tcode: string;\n\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\tlang: string;\n\t\t\t\t\t\t\tvalue: string;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tinnererror: {\n\t\t\t\t\t\t\terrordetails: {\n\t\t+
\t\t\t\t\t\tmessage: string;\n\t\t\t\t\t\t\t\tcode: string;\n\t\t\t\t\t\t\t\tseverity: \"Error\" | \"Warning\" | \"Information\";\n\t\t\t\t\t\t\t}[];\n\t\t\t\t\t\t};\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\tMessageBox.error(json.error.message.value);\n\t\t\t}\+
n\t\t});\n\t}\n\tgetActions(): MetadataAction[] {\n\t\treturn [];\n\t}\n\n\tdestroy(): void {}\n\n\tasync createEntity(\n\t\toptions: {\n\t\t\tentityName: string;\n\t\t\tproperties: Record<string, unknown>;\n\t\t\theaders: Record<string, string>;\n\t\t}\+
n\t): Promise<void> {\n\t\tthis.model.setHeaders(options.headers);\n\t\tawait new Promise<void>((resolve, reject) => {\n\t\t\tthis.model.create(`/${options.entityName}`, options.properties, {\n\t\t\t\tsuccess: () => resolve(),\n\t\t\t\terror: (error: Err+
or) => reject(error),\n\t\t\t});\n\t\t});\n\t}\n\tasync getEntity(\n\t\toptions: {\n\t\t\tentityName: string;\n\t\t\tkeys: Record<string, string | number | boolean>;\n\t\t\theaders: Record<string, string>;\n\t\t}\n\t): Promise<object> {\n\t\tthis.model.s+
etHeaders(options.headers);\n\t\tconst path = this.model.createKey(`/${options.entityName}`, options.keys);\n\t\tconst context = await new Promise<Context>((resolve, reject) => {\n\t\t\tthis.model.createBindingContext(\n\t\t\t\tpath,\n\t\t\t\tundefined,\+
n\t\t\t\t{},\n\t\t\t\t(data: Context) => {\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(new Error(\"Failed to create binding context\"));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t});\n\t\treturn +
context.getObject();\n\t}\n\n\tasync deleteEntity(\n\t\toptions: {\n\t\t\tentityName: string;\n\t\t\tkeys: Record<string, string | number | boolean>;\n\t\t\theaders: Record<string, string>;\n\t\t}\n\t): Promise<void> {\n\t\tthis.model.setHeaders(options.+
headers);\n\t\tconst path = this.model.createKey(`/${options.entityName}`, options.keys);\n\t\tawait new Promise<void>((resolve, reject) => {\n\t\t\tthis.model.remove(path, {\n\t\t\t\tsuccess: () => resolve(),\n\t\t\t\terror: (error: Error) => reject(err+
or),\n\t\t\t});\n\t\t});\n\t}\n\n\tasync initAsync() {\n\t\ttry {\n\t\t\tawait this.model.metadataLoaded(true);\n\t\t} catch (error) {\n\t\t\tMessageBox.error(\"Failed to load metadata of Service \" + this.serviceUrl + \":\\n\\nPlease check Backend confi+
guration and try again.\", {\n\t\t\t\tdetails: Util.getErrorMessage(error)\n\t\t\t});\n\t\t\tthrow error;\n\t\t}\n\t\tthis.metadataText = await ODataHelper.getMetadataText(this.serviceUrl);\n\t\tthis.metadataXml = ODataHelper.parseMetadataXml(this.metada+
taText);\n\t}\n\n\tgetEntities(): MetadataEntity[] {\n\t\tconst entities: MetadataEntity[] = [];\n\n\t\tconst entitySets = Array.from(\n\t\t\tthis.metadataXml.getElementsByTagName(\"EntitySet\")\n\t\t).map((node) => ({\n\t\t\tName: node.getAttribute(\"Na+
me\"),\n\t\t\tEntityType: node.getAttribute(\"EntityType\"),\n\t\t}));\n\n\t\tfor (const entity of entitySets) {\n\t\t\tlet entityType = entity.EntityType;\n\t\t\tif (entityType.includes(\".\")) {\n\t\t\t\tentityType = entityType.split(\".\").pop();\n\t\+
t\t}\n\t\t\tconst entityTypeNode = Array.from(\n\t\t\t\tthis.metadataXml.getElementsByTagName(\"EntityType\")\n\t\t\t).find((node) => {\n\t\t\t\treturn node.getAttribute(\"Name\") === entityType;\n\t\t\t});\n\t\t\tconst properties = Array.from(\n\t\t\t\t+
entityTypeNode.getElementsByTagName(\"Property\")\n\t\t\t).map((propertyNode) => ({\n\t\t\t\tname: propertyNode.getAttribute(\"Name\"),\n\t\t\t\ttype: propertyNode.getAttribute(\"Type\"),\n\t\t\t\tnullable: propertyNode.getAttribute(\"Nullable\"),\n\t\t\+
t\tmaxLength: ODataHelper.getMaxLength(\n\t\t\t\t\tpropertyNode.getAttribute(\"MaxLength\")\n\t\t\t\t),\n\t\t\t}));\n\t\t\tconst keyNode = entityTypeNode.getElementsByTagName(\"Key\")[0];\n\n\t\t\tconst propertyRefs = Array.from(\n\t\t\t\tkeyNode.getElem+
entsByTagName(\"PropertyRef\")\n\t\t\t).map((keyNode) => ({\n\t\t\t\tname: keyNode.getAttribute(\"Name\"),\n\t\t\t\ttype: properties.find(\n\t\t\t\t\t(property) => property.name === keyNode.getAttribute(\"Name\")\n\t\t\t\t).type,\n\t\t\t\tnullable: prope+
rties.find(\n\t\t\t\t\t(property) => property.name === keyNode.getAttribute(\"Name\")\n\t\t\t\t).nullable,\n\t\t\t\tmaxLength: properties.find(\n\t\t\t\t\t(property) => property.name === keyNode.getAttribute(\"Name\")\n\t\t\t\t).maxLength,\n\t\t\t}));\n\+
n\t\t\tentities.push({\n\t\t\t\tname: entity.Name,\n\t\t\t\tentityType: entityType,\n\t\t\t\tproperties: properties,\n\t\t\t\tkeys: propertyRefs,\n\t\t\t});\n\t\t}\n\t\treturn entities.filter((entity) => !entity.name.startsWith(\"SAP__\"));\n\t}\n\tgetMe+
tadataText(): string {\n\t\treturn this.metadataText;\n\t}\n\tgetMetadataXml(): XMLDocument {\n\t\treturn this.metadataXml;\n\t}\n\tgetFunctions(): MetadataFunction[] {\n\t\tconst functionImports = Array.from(\n\t\t\tthis.metadataXml.getElementsByTagName+
(\"FunctionImport\")\n\t\t).map((node) => ({\n\t\t\tName: node.getAttribute(\"Name\"),\n\t\t\tReturnType: node.getAttribute(\"ReturnType\"),\n\t\t\tEntitySet: node.getAttribute(\"EntitySet\"),\n\t\t\tHttpMethod: node.getAttribute(\"m:HttpMethod\"),\n\t\t+
\tParameters: Array.from(node.getElementsByTagName(\"Parameter\")).map(\n\t\t\t\t(paramNode) => ({\n\t\t\t\t\tname: paramNode.getAttribute(\"Name\"),\n\t\t\t\t\ttype: paramNode.getAttribute(\"Type\"),\n\t\t\t\t\tnullable: paramNode.getAttribute(\"Nullabl+
e\"),\n\t\t\t\t\tmaxLength: ODataHelper.getMaxLength(\n\t\t\t\t\t\tparamNode.getAttribute(\"MaxLength\")\n\t\t\t\t\t),\n\t\t\t\t})\n\t\t\t),\n\t\t}));\n\n\t\treturn functionImports.map((func) => ({\n\t\t\tname: func.Name,\n\t\t\treturnType: func.ReturnTy+
pe,\n\t\t\tentitySet: func.EntitySet,\n\t\t\tparameters: func.Parameters,\n\t\t\tmethod: func.HttpMethod as MetadataFunctionMethod,\n\t\t}));\n\t}\n\n\tgetModel(): ODataModel {\n\t\treturn this.model as unknown as ODataModel;\n\t}\n\n\tasync readEntity(o+
ptions: {\n\t\tentityName: string;\n\t\tfilters: Filter[];\n\t\tsorting: Sorter[];\n\t\theaders: Record<string, string>;\n\t\ttop: number;\n\t\tskip: number;\n\t}) {\n\t\tthis.model.setHeaders(options.headers);\n\t\treturn await new Promise((resolve, rej+
ect) => {\n\t\t\tthis.model.read(`/${options.entityName}`, {\n\t\t\t\tsuccess: (data: object) => {\n\t\t\t\t\tresolve(data);\n\t\t\t\t},\n\t\t\t\terror: (error: Error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t},\n\t\t\t\tfilters: options.filters.length > +
0 ? options.filters : undefined,\n\t\t\t\tsorters: options.sorting.length > 0 ? options.sorting : undefined,\n\t\t\t\turlParameters: {\n\t\t\t\t\t$top: options.top.toString(),\n\t\t\t\t\t$skip: options.skip.toString(),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t+
}\n\n\tasync executeFunction(options: {\n\t\tfunctionName: string;\n\t\tparameters: Record<string, string | number | boolean>;\n\t\tmethod: \"GET\" | \"POST\";\n\t}): Promise<unknown> {\n\t\treturn await new Promise((resolve, reject) => {\n\t\t\tthis.mod+
el.callFunction(`/${options.functionName}`, {\n\t\t\t\turlParameters: options.parameters,\n\t\t\t\tmethod: options.method,\n\t\t\t\tsuccess: (data: object) => resolve(data),\n\t\t\t\terror: (error: Error) => reject(error),\n\t\t\t});\n\t\t});\n\t}\n\n\te+
xecuteAction(options: {\n\t\tactionName: string;\n\t\tparameters: Record<string, string | number | boolean>;\n\t\tmethod: \"GET\" | \"POST\";\n\t}): Promise<unknown> {\n\t\tthrow new Error(\"Not implemented: \" + JSON.stringify(options));\n\t}\n}\n"],"ma+
ppings":"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","ignoreList":[]}                                        