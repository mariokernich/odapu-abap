sap.ui.define(["sap/ui/model/odata/v2/ODataModel","./ODataHelper","sap/m/MessageBox","./Util","./SoundManager"],function(e,t,a,r,n){"use strict";function s(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const i=s(t);const o=s(r);co+
nst m=s(n);class l{constructor(t){this.serviceUrl=t;this.model=new e(t,{});this.model.attachRequestFailed({},e=>{void m.FireError();const t=e.getParameters();const r=t.response.responseText;if(r.startsWith("<?xml")){const e=new DOMParser;const t=e.parseF+
romString(r,"text/xml");const n=t.getElementsByTagName("message")[0];if(n){a.error(n.textContent)}else{a.error("Unknown error occurred")}}else{const e=JSON.parse(r);a.error(e.error.message.value)}})}getActions(){return[]}getComplexTypes(){const e=[];cons+
t t=Array.from(this.metadataXml?.getElementsByTagName("ComplexType")||[]);for(const a of t){const t=a.getAttribute("Name");if(!t)continue;const r=Array.from(a.getElementsByTagName("Property")).map(e=>({name:e.getAttribute("Name")||"",type:e.getAttribute(+
"Type")||"",nullable:e.getAttribute("Nullable")||"",maxLength:i.getMaxLength(e.getAttribute("MaxLength")||"")}));e.push({name:t,properties:r})}return e.filter(e=>!e.name.startsWith("SAP__"))}destroy(){}async createEntity(e){this.model.setHeaders(e.header+
s);await new Promise((t,a)=>{this.model.create(`/${e.entityName}`,e.properties,{success:()=>t(),error:e=>a(e)})});await m.FireSuccess()}async getEntity(e){this.model.setHeaders(e.headers);const t=Object.entries(e.keys).map(([e,t])=>`${e}='${t}'`).join(",+
");const a={};if(e.expand&&e.expand.length>0){a.$expand=e.expand.join(",")}const r=await new Promise((r,n)=>{this.model.read(`/${e.entityName}(${t})`,{success:e=>{r(e)},error:e=>{n(e)},urlParameters:Object.keys(a).length>0?a:undefined})});await m.FireSuc+
cess();return r}async deleteEntity(e){this.model.setHeaders(e.headers);const t=this.model.createKey(`/${e.entityName}`,e.keys);await new Promise((e,a)=>{this.model.remove(t,{success:()=>e(),error:e=>a(e)})});await m.FireSuccess()}async initAsync(){try{aw+
ait this.model.metadataLoaded(true)}catch(e){a.error("Failed to load metadata of Service "+this.serviceUrl+":\n\nPlease check Backend configuration and try again.",{details:o.getErrorMessage(e)});throw e}this.metadataText=await i.getMetadataText(this.ser+
viceUrl);this.metadataXml=i.parseMetadataXml(this.metadataText)}getEntities(){const e=[];const t=Array.from(this.metadataXml?.getElementsByTagName("EntitySet")||[]).map(e=>({Name:e.getAttribute("Name"),EntityType:e.getAttribute("EntityType")}));for(const+
 a of t){let t=a.EntityType;if(t&&t.includes(".")){t=t.split(".").pop()}const r=Array.from(this.metadataXml?.getElementsByTagName("EntityType")||[]).find(e=>e.getAttribute("Name")===t);if(!r)continue;const n=Array.from(r.getElementsByTagName("Property"))+
.map(e=>({name:e.getAttribute("Name")||"",type:e.getAttribute("Type")||"",nullable:e.getAttribute("Nullable")||"",maxLength:i.getMaxLength(e.getAttribute("MaxLength")||"")}));const s=r.getElementsByTagName("Key")[0];const o=s?Array.from(s.getElementsByTa+
gName("PropertyRef")).map(e=>{const t=e.getAttribute("Name")||"";const a=n.find(e=>e.name===t)||{name:t,type:"",nullable:"",maxLength:0};return{name:a.name,type:a.type,nullable:a.nullable,maxLength:a.maxLength}}):[];const m=Array.from(r.getElementsByTagN+
ame("NavigationProperty")).map(e=>({name:e.getAttribute("Name")||"",relationship:e.getAttribute("Relationship")||"",fromRole:e.getAttribute("FromRole")||"",toRole:e.getAttribute("ToRole")||""}));e.push({name:a.Name||"",entityType:t||"",properties:n,keys:+
o,navigationProperties:m})}return e.filter(e=>!e.name.startsWith("SAP__"))}getAssociations(){const e=[];const t=Array.from(this.metadataXml?.getElementsByTagName("Association")||[]);for(const a of t){const t=a.getAttribute("Name")||"";const r=Array.from(+
a.getElementsByTagName("End"));const n=r.map(e=>({type:e.getAttribute("Type")||"",multiplicity:e.getAttribute("Multiplicity")||"",role:e.getAttribute("Role")||"",onDeleteAction:(()=>{const t=e.getElementsByTagName("OnDelete")[0];return t?t.getAttribute("+
Action")||undefined:undefined})()}));const s=a.getElementsByTagName("ReferentialConstraint")[0];let i=undefined;if(s){const e=s.getElementsByTagName("Principal")[0];const t=s.getElementsByTagName("Dependent")[0];i={principal:e?[{role:e.getAttribute("Role+
")||"",propertyRef:Array.from(e.getElementsByTagName("PropertyRef")).map(e=>({name:e.getAttribute("Name")||""}))}]:[],dependent:{role:t?.getAttribute("Role")||"",propertyRef:t?Array.from(t.getElementsByTagName("PropertyRef")).map(e=>({name:e.getAttribute+
("Name")||""})):[]}}}e.push({name:t,end:n,referentialConstraint:i})}return e}getMetadataText(){return this.metadataText||""}getMetadataXml(){return this.metadataXml||new XMLDocument}getFunctions(){const e=Array.from(this.metadataXml?.getElementsByTagName+
("FunctionImport")||[]).map(e=>({Name:e.getAttribute("Name"),ReturnType:e.getAttribute("ReturnType"),EntitySet:e.getAttribute("EntitySet"),HttpMethod:e.getAttribute("m:HttpMethod"),Parameters:Array.from(e.getElementsByTagName("Parameter")).map(e=>({name:+
e.getAttribute("Name"),type:e.getAttribute("Type"),nullable:e.getAttribute("Nullable"),maxLength:i.getMaxLength(e.getAttribute("MaxLength")||"")}))}));return e.map(e=>({name:e.Name,returnType:e.ReturnType,entitySet:e.EntitySet,parameters:e.Parameters,met+
hod:e.HttpMethod}))}getModel(){return this.model}async readEntity(e){this.model.setHeaders(e.headers);const t={$top:e.top.toString(),$skip:e.skip.toString()};if(e.expand&&e.expand.length>0){t.$expand=e.expand.join(",")}const a=await new Promise((a,r)=>{t+
his.model.read(`/${e.entityName}`,{success:e=>{a(e)},error:e=>{r(e)},filters:e.filters.length>0?e.filters:undefined,sorters:e.sorting.length>0?e.sorting:undefined,urlParameters:t})});await m.FireSuccess();return a}async executeFunction(e){const t=await n+
ew Promise((t,a)=>{this.model.callFunction(`/${e.functionName}`,{urlParameters:e.parameters,method:e.method,success:e=>t(e),error:e=>a(e)})});await m.FireSuccess();return t}executeAction(e){throw new Error("Not implemented: "+JSON.stringify(e))}}return l+
});                                                                                                                                                                                                                                                            
//# sourceMappingURL=OData2Client.js.map                                                                                                                                                                                                                       