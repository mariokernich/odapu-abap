sap.ui.define(["./BaseController","sap/m/Dialog","sap/m/Button","sap/ui/model/json/JSONModel","sap/m/Label","sap/m/MessageToast","../Constants","sap/m/Input","sap/m/VBox","sap/m/MessageBox","../util/Util","sap/ui/Device","../util/OData2Client","../util/O+
Data4Client","sap/ui/model/Filter","sap/ui/core/Core","sap/m/Column","sap/m/Text","sap/m/ColumnListItem","sap/m/HBox","sap/ui/core/Icon","sap/ui/model/Sorter"],function(e,t,s,i,n,o,r,a,c,l,d,h,u,p,y,g,f,m,S,w,v,P){"use strict";function D(e){return e&&e._+
_esModule&&typeof e.default!=="undefined"?e.default:e}const E=D(e);const M=D(r);const V=D(d);const C=D(u);const B=D(p);const F=E.extend("de.kernich.odpu.controller.OData",{constructor:function e(){E.prototype.constructor.apply(this,arguments);this.select+
edService={service:null,entities:null,actions:null};this.localData={resourceType:"entity",selectedEntityName:"",selectedFunctionName:"",response:"",selectedMethod:"GET",selectedServiceFunctions:[],selectedEntityProperties:{properties:[],keyProperties:[]}+
,entityCount:0,functionCount:0,actionCount:0,top:10,skip:0,dark:false,statusCode:0,view:"odata",folderTreeIcon:sap.ui.require.toUrl("de/kernich/odpu/img/folder-tree-light.svg"),dataViewMode:"json",selectedServiceActions:[]};this.fragmentId="";this.values+
={}},onInit:function e(){E.prototype.onInit.call(this);void this.handleInit();this.registerModels()},registerModels:function e(){this.getView()?.setModel(new i(this.localData,true),"local");this.getView()?.setModel(new i(this.selectedService,true),"selec+
tedService");this.getView()?.setModel(new i({name:"",returnType:"",entitySet:"",method:"GET",parameters:[]},true),"selectedFunction");this.getView()?.setModel(new i({name:"",returnType:"",entitySet:"",method:"POST",parameters:[]},true),"selectedAction");+
this.getView()?.setModel(new i([],true),"entityFilters");this.getView()?.setModel(new i([],true),"entitySorting");this.getView()?.setModel(new i([],true),"requestHistory");this.getView()?.setModel(new i([],true),"requestHeaders")},handleInit:async functi+
on e(){await this.getGlobalModel().dataLoaded();this.setBusy(true);const t=this.getOwnerComponent().getModel();await t.metadataLoaded(true);t.setSizeLimit(M.SERVICE_QUERY_LIMIT);this.setBusy(false);if(!h.support.websocket){o.show(this.component.getText("+
msg.websocketNotSupported"))}},onSelectService:function e(){void this.handleServiceSelection()},onSelectEntity:function e(){this.handleEntityChanged()},onSelectFunction:function e(){this.handleFunctionChanged()},onSelectAction:function e(){this.handleAct+
ionChanged()},onAddFilterButtonPress:function e(){void this.handleAddFilter()},onAddSortButtonPress:function e(){void this.handleAddSort()},onButtonSortDeletePress:function e(t){const s=t.getSource().getBindingContext("entitySorting");const i=s.getObject+
();void this.handleButtonSortDeletePress(i)},onSendRequest:function e(){this.clearResult();if(this.localData.resourceType==="entity"){switch(this.localData.selectedMethod){case"GET":void this.execEntityRead();break;case"GETBY":void this.execEntityGetSing+
le();break;case"POST":void this.execEntityCreate();break;case"DELETE":void this.execEntityDelete();break}}else if(this.localData.resourceType==="function"){void this.execFunctionRequest()}else{throw new Error(`Unknown resource type: ${this.localData.reso+
urceType}`)}},onShowMetadata:function e(){const t=this.odataClient?.getMetadataText();if(!t)return;void this.component.dialogManager.showXmlCodeEditor(t)},onAddHeader:function e(){void this.handleAddHeader()},onButtonSaveConfigurationPress:function e(){v+
oid this.handleSaveConfiguration()},onButtonLoadConfigurationPress:function e(){void this.handleLoadConfiguration()},handleServiceSelection:async function e(){const t=await this.pickService();await this.loadService(t)},loadService:async function e(t){thi+
s.setBusy(true);try{this.selectedService.service=t;this.setTitle(t.ServiceName);this.localData.selectedEntityName="";this.localData.selectedFunctionName="";this.localData.selectedServiceFunctions=[];this.localData.resourceType="entity";this.localData.sel+
ectedMethod="GET";this.odataClient?.destroy();this.odataClient=undefined;switch(t.ODataType){case"2":this.odataClient=new C(t.ServicePath);break;case"4":this.odataClient=new B(t.ServicePath);break;default:o.show(this.component.getText("msg.serviceTypeNot+
Supported"));break}await(this.odataClient?.initAsync());this.handleServiceSelected()}finally{this.setBusy(false)}},handleServiceSelected:function e(){this.setBusy(true);try{this.resetFilters();this.resetSorting();this.resetEntityInputs();this.selectedSer+
vice.entities=this.odataClient?.getEntities()||[];this.localData.selectedServiceFunctions=this.odataClient?.getFunctions()||[];this.localData.selectedServiceActions=this.odataClient?.getActions()||[];this.localData.entityCount=this.selectedService.entiti+
es?.length||0;this.localData.functionCount=this.localData.selectedServiceFunctions?.length||0;this.localData.actionCount=this.localData.selectedServiceActions?.length||0;if(this.selectedService.entities?.length>0){this.localData.selectedEntityName=this.s+
electedService.entities[0].name;this.handleEntityChanged()}if(this.localData.selectedServiceFunctions?.length>0){this.localData.selectedFunctionName=this.localData.selectedServiceFunctions[0].name;this.handleFunctionChanged()}if(this.localData.selectedSe+
rviceActions?.length>0){this.localData.selectedActionName=this.localData.selectedServiceActions[0].name;this.handleActionChanged()}}finally{this.setBusy(false)}},pickService:async function e(){this.setBusy(true);try{return await this.component.dialogMana+
ger.pickService()}finally{this.setBusy(false)}},handleEntityChanged:function e(){this.resetFilters();this.resetSorting();this.resetEntityInputs();const t=this.selectedService.entities.find(e=>e.name===this.localData.selectedEntityName)?.properties;this.l+
ocalData.selectedEntityProperties.properties=t||[];this.localData.selectedEntityProperties.keyProperties=this.selectedService.entities.find(e=>e.name===this.localData.selectedEntityName)?.keys||[];this.localData.selectedEntityProperties.properties=this.l+
ocalData.selectedEntityProperties.properties.filter(e=>!this.localData.selectedEntityProperties.keyProperties.some(t=>t.name===e.name))},handleFunctionChanged:function e(){this.resetFunctionInputs();const t=this.localData.selectedServiceFunctions.find(e=+
>e.name===this.localData.selectedFunctionName);this.getView().getModel("selectedFunction").setProperty("/",t)},handleActionChanged:function e(){this.resetFunctionInputs();const t=this.localData.selectedServiceActions?.find(e=>e.name===this.localData.sele+
ctedActionName);if(t){(this.getView()?.getModel("selectedAction")).setProperty("/",t)}},execEntityCreate:async function e(){this.setBusy(true);try{const e=this.getEntityPropertyValues();const t=e.keyProperties;const s={...e.properties,...t};await(this.od+
ataClient?.createEntity({entityName:this.localData.selectedEntityName,properties:s,headers:this.getHeaders()}));this.localData.response="";o.show(this.component.getText("msg.entityCreated"))}catch(e){l.error(e.toString())}finally{this.setBusy(false)}},ex+
ecEntityDelete:async function e(){this.setBusy(true);try{const e=this.getEntityPropertyValues();if(Object.values(e.keyProperties).some(e=>e==="")){l.error(this.component.getText("msg.enterKeyProperties",[Object.keys(e.keyProperties).join(", ")]));this.se+
tBusy(false);return}await(this.odataClient?.deleteEntity({entityName:this.localData.selectedEntityName,keys:e.keyProperties,headers:this.getHeaders()}));this.localData.response="";o.show(this.component.getText("msg.entityDeleted"))}finally{this.setBusy(f+
alse)}},execEntityGetSingle:async function e(){this.setBusy(true);try{const e=this.getEntityPropertyValues();if(Object.values(e.keyProperties).some(e=>e==="")){const t=Object.keys(e.keyProperties).filter(t=>e.keyProperties[t]==="");l.error(this.component+
.getText("msg.enterKeyProperties",[t.join(", ")]));this.setBusy(false);return}const t=await(this.odataClient?.getEntity({entityName:this.localData.selectedEntityName,keys:e.keyProperties,headers:this.getHeaders()}));this.localData.response=JSON.stringify+
(t,null,2);this.setTableResponse(t)}finally{this.setBusy(false)}},execEntityRead:async function e(){this.setBusy(true);const t=this.getHeaders();const s=(this.getView()?.getModel("entityFilters")).getProperty("/");const i=(this.getView()?.getModel("entit+
ySorting")).getProperty("/");try{const e=await(this.odataClient?.readEntity({entityName:this.localData.selectedEntityName,filters:s.map(e=>new y(e.property,e.operator,e.value)),sorting:i.map(e=>new P(e.property,e.direction==="desc")),headers:t,top:this.l+
ocalData.top,skip:this.localData.skip}));this.localData.response=JSON.stringify(e,null,2);this.setTableResponse(e);const n=(this.getView()?.getModel("requestHistory")).getProperty("/");n.push({method:"READ",entity:this.localData.selectedEntityName,timest+
amp:(new Date).toISOString(),statusCode:200,response:this.localData.response});(this.getView()?.getModel("requestHistory")).setProperty("/",n)}finally{this.setBusy(false)}},getResultTable:function e(){return this.getById("idResponseTable")},clearResult:f+
unction e(){const t=this.getResultTable();t.removeAllColumns();t.removeAllItems();this.localData.response=""},setTableResponse:function e(t){const s=this.getById("idResponseTable");const i={...this.localData.selectedEntityProperties.properties,...this.lo+
calData.selectedEntityProperties.keyProperties};const n=[];const o=Object.keys(i);for(const e of o){n.push({name:i[e].name,isKey:this.localData.selectedEntityProperties.keyProperties.some(t=>t.name===i[e].name)})}let r=[];if(Array.isArray(t)){r=t}else if+
(t&&typeof t==="object"){const e=t;if("results"in e&&Array.isArray(e.results)){r=e.results}else{r=[e]}}if(r.length===0){return}for(const e of n){const t=e.name;let i=t.length;r.forEach(t=>{const s=t[e.name];let n="";if(s!==null&&s!==undefined){if(typeof +
s==="object"){n=JSON.stringify(s,null,2)}else{n=String(s)}}i=Math.max(i,n.length)});const n=i*10+16;const o=new c({items:[new w({items:[e.isKey?new v({src:"sap-icon://key"}).addStyleClass("sapUiTinyMarginEnd"):null,new m({text:t})].filter(Boolean),alignI+
tems:"Center"})]});s.addColumn(new f({header:o,width:`${n}px`}))}for(const e of r){const t=n.map(t=>{const s=e[t.name];let i="";if(s!==null&&s!==undefined){if(typeof s==="object"){i=JSON.stringify(s,null,2)}else{i=String(s)}}return new m({text:i})});s.ad+
dItem(new S({cells:t}))}},execFunctionRequest:async function e(){this.setBusy(true);try{const e=this.getView().getModel("selectedFunction").getProperty("/");const t=this.getFunctionParameterValues();const s=await(this.odataClient?.executeFunction({functi+
onName:e.name,parameters:t,method:e.method}));this.localData.response=JSON.stringify(s,null,2)}finally{this.setBusy(false)}},resetFilters:function e(){(this.getView()?.getModel("entityFilters")).setProperty("/",[])},resetSorting:function e(){(this.getVie+
w()?.getModel("entitySorting")).setProperty("/",[])},handleAddFilter:async function e(){const t=this.selectedService.entities.find(e=>e.name===this.localData.selectedEntityName);if(!t){l.error(this.component.getText("msg.entityNotFound"));return}const s=+
await this.component.dialogManager.addFilter(t.properties);const i=this.getView().getModel("entityFilters").getProperty("/");const n=i.find(e=>e.property===s.property&&e.operator===s.operator&&e.value===s.value);if(n){l.error(this.component.getText("msg.+
filterConflict"));return}i.push(s);(this.getView()?.getModel("entityFilters")).setProperty("/",i)},handleAddHeader:async function e(){const t=await this.component.dialogManager.showAddHeaderDialog();const s=(this.getView()?.getModel("requestHeaders")).ge+
tProperty("/");const i=s.find(e=>e.key===t.key);if(i){l.error(this.component.getText("msg.headerExists",[t.key]))}else{s.push({key:t.key,value:t.value});(this.getView()?.getModel("requestHeaders")).setProperty("/",s)}},onEditHeader:function e(i){const r=+
i.getSource().getBindingContext("requestHeaders");const l=(this.getView()?.getModel("requestHeaders")).getProperty("/");const d=r.getObject();const h=()=>{if(u.getValue()===""){o.show(this.component.getText("msg.enterValue"));return}const e=l.findIndex(e+
=>e.key===d.key);if(e>-1){l[e].value=u.getValue();(this.getView()?.getModel("requestHeaders")).setProperty("/",l)}p.close();p.destroy()};const u=new a({value:d.value,submit:h});const p=new t({title:"Edit Value of "+d.key,contentWidth:"400px",content:[new+
 c({items:[new n({text:"Value"}),u.addStyleClass("sapUiSmallMarginBottom")]}).addStyleClass("sapUiSmallMargin")]});p.setBeginButton(new s({text:"Save",press:h,type:"Emphasized",icon:"sap-icon://accept"}));p.setEndButton(new s({text:"Cancel",press:()=>{p.+
close();p.destroy()},type:"Ghost",icon:"sap-icon://decline"}));p.open();u.selectText(0,d.value.length)},onDeleteHeader:function e(t){const s=t.getSource().getBindingContext("requestHeaders");const i=s.getObject();const n=(this.getView()?.getModel("reques+
tHeaders")).getProperty("/");const o=n.findIndex(e=>e.key===i.key);if(o>-1){n.splice(o,1)}(this.getView()?.getModel("requestHeaders")).setProperty("/",n)},getHeaders:function e(){const t={};const s=(this.getView()?.getModel("requestHeaders")).getProperty+
("/");s.forEach(e=>{t[e.key]=e.value});return t},onSourceCopy:function e(){void this.handleCopy()},onSourceDownload:function e(){const t=this.localData.response;if(t){V.download(t,"response.json")}else{o.show(this.component.getText("msg.noResponseToDownl+
oad"))}},handleCopy:async function e(){const t=this.localData.response;if(t){await V.copy2Clipboard(t);o.show(this.component.getText("msg.responseCopied"))}else{o.show(this.component.getText("msg.noResponseToCopy"))}},onInputPropertyChange:function e(t){+
const s=t.getSource();const i=s.getName();const n=s.getValue();this.values[i]=n},getById:function e(t){const s=this.fragmentId;const i=`${s}--${t}`;const n=g.byId(i);return n},getFunctionParameterValues:function e(){const t=this.getById("idParametersVBox+
");const s=V.getAllInputValues(t);return s},getEntityPropertyValues:function e(){const t=this.getById("idPropertiesVBox");const s=this.getById("idKeyPropertiesVBox");const i=V.getAllInputValues(t);const n=V.getAllInputValues(s);return{properties:i,keyPro+
perties:n}},resetEntityInputs:function e(){const t=this.getById("idPropertiesVBox");const s=this.getById("idKeyPropertiesVBox");V.resetInputs(t);V.resetInputs(s)},resetFunctionInputs:function e(){const t=this.getById("idParametersVBox");V.resetInputs(t)}+
,onButtonFilterDeletePress:function e(t){const s=t.getSource().getBindingContext("entityFilters");const i=s.getObject();void this.handleButtonFilterDeletePress(i)},onButtonFilterEditPress:function e(t){const s=t.getSource().getBindingContext("entityFilte+
rs");const i=s.getObject();void this.handleButtonFilterEditPress(i)},handleButtonFilterDeletePress:function e(t){const s=(this.getView()?.getModel("entityFilters")).getProperty("/");const i=s.filter(e=>e.property!==t.property&&e.operator!==t.operator&&e.+
value!==t.value);(this.getView()?.getModel("entityFilters")).setProperty("/",i)},handleButtonFilterEditPress:async function e(t){const s=this.selectedService.entities.find(e=>e.name===this.localData.selectedEntityName);if(!s){l.error("Entity not found");+
return}const i=(this.getView()?.getModel("entityFilters")).getProperty("/");const n=i.findIndex(e=>e.property===t.property&&e.operator===t.operator&&e.value===t.value);const o=await this.component.dialogManager.editFilter(t,s.properties);const r=i.find(e+
=>e.property===o.property&&e.operator===o.operator&&e.value===o.value);if(r){l.error("Conflict with existing record");return}i[n]=o;this.getView().getModel("entityFilters").setProperty("/",i)},onButtonViewResponsePress:function e(t){const s=t.getSource()+
.getBindingContext("requestHistory");const i=s.getObject();this.localData.response=i.response},handleAddSort:async function e(){const t=this.selectedService.entities.find(e=>e.name===this.localData.selectedEntityName);if(!t){l.error("Entity not found");r+
eturn}const s=await this.component.dialogManager.addSort(t.properties);const i=(this.getView()?.getModel("entitySorting")).getProperty("/");const n=i.find(e=>e.property===s.property);if(n){l.error(this.component.getText("msg.propertyAlreadySorted"));retu+
rn}i.push(s);(this.getView()?.getModel("entitySorting")).setProperty("/",i)},handleButtonSortDeletePress:function e(t){const s=(this.getView()?.getModel("entitySorting")).getProperty("/");const i=s.filter(e=>e.property!==t.property);(this.getView()?.getM+
odel("entitySorting")).setProperty("/",i)},handleSaveConfiguration:async function e(){this.setBusy(true);try{const e=await this.component.dialogManager.showSaveProjectDialog();const t=(this.getView()?.getModel("local")).getProperty("/");const s=(this.get+
View()?.getModel("entityFilters")).getProperty("/");const i=(this.getView()?.getModel("requestHeaders")).getProperty("/");const n=(this.getView()?.getModel("entitySorting")).getProperty("/");const r=(this.getView()?.getModel("selectedService")).getProper+
ty("/");const a={ProjectName:e,Odatatype:r.service.ODataType,ServiceName:r.service.ServiceName,ServicePath:r.service.ServicePath,ServiceVersion:r.service.Version,EntityMethod:t.selectedMethod,EntityName:t.selectedEntityName,FunctionName:t.selectedFunctio+
nName,ActionName:"",RequestType:t.resourceType,Top:t.top??0,Skip:t.skip??0,Headers:JSON.stringify(i),Filters:JSON.stringify(s),Sorters:JSON.stringify(n)};await this.component.requests.createProject(a);o.show(this.component.getText("msg.configurationSaved+
"))}finally{this.setBusy(false)}},handleLoadConfiguration:async function e(){try{const e=await this.component.dialogManager.showProjectListDialog();if(e){const t=(this.getView()?.getModel("local")).getProperty("/");const s={ServiceName:e.ServiceName,ODat+
aType:e.Odatatype,ServicePath:e.ServicePath,Version:e.ServiceVersion};await this.loadService(s);t.resourceType=e.RequestType;t.selectedEntityName=e.EntityName;t.selectedFunctionName=e.FunctionName;t.selectedMethod=e.EntityMethod;t.top=e.Top?e.Top:10;t.sk+
ip=e.Skip?e.Skip:0;(this.getView()?.getModel("local")).setProperty("/",t);(this.getView()?.getModel("entityFilters")).setProperty("/",JSON.parse(e.Filters));(this.getView()?.getModel("entitySorting")).setProperty("/",JSON.parse(e.Sorters));(this.getView(+
)?.getModel("requestHeaders")).setProperty("/",JSON.parse(e.Headers));o.show(this.component.getText("msg.configurationLoaded"))}}catch(e){if(e instanceof Error&&e.message!=="Dialog closed"){l.error(`Error loading configuration: ${e.message}`)}}},setTitle+
:function e(t){throw new Error("Not implemented: "+t)}});return F});                                                                                                                                                                                           
//# sourceMappingURL=OData.controller.js.map                                                                                                                                                                                                                   