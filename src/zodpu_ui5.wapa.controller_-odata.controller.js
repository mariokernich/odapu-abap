sap.ui.define(["./BaseController","sap/m/Dialog","sap/m/Button","sap/ui/model/json/JSONModel","sap/m/Label","sap/m/MessageToast","../Constants","sap/m/Input","sap/m/VBox","sap/m/MessageBox","../util/Util","sap/ui/Device","../util/OData2Client","../util/O+
Data4Client","sap/ui/model/Filter","sap/ui/core/Core","sap/m/Column","sap/m/Text","sap/m/ColumnListItem","sap/m/HBox","sap/ui/core/Icon","sap/ui/model/Sorter"],function(e,t,s,i,n,o,r,a,l,c,d,u,h,y,p,g,f,m,S,w,v,P){"use strict";function E(e){return e&&e._+
_esModule&&typeof e.default!=="undefined"?e.default:e}const D=E(e);const M=E(r);const V=E(d);const B=E(h);const C=E(y);const F=D.extend("de.kernich.odpu.controller.OData",{constructor:function e(){D.prototype.constructor.apply(this,arguments);this.select+
edService={service:null,entities:null,actions:null};this.localData={resourceType:"entity",selectedEntityName:"",selectedFunctionName:"",response:"",selectedMethod:"GET",selectedServiceFunctions:[],selectedEntityProperties:{properties:[],keyProperties:[]}+
,entityCount:0,functionCount:0,actionCount:0,top:10,skip:0,dark:false,statusCode:0,view:"odata",folderTreeIcon:sap.ui.require.toUrl("de/kernich/odpu/img/folder-tree-light.svg"),dataViewMode:"json",selectedServiceActions:[]};this.fragmentId="";this.values+
={}},onInit:function e(){D.prototype.onInit.call(this);void this.handleInit();this.registerModels()},registerModels:function e(){this.getView().setModel(new i(this.localData,true),"local");this.getView().setModel(new i(this.selectedService,true),"selecte+
dService");this.getView().setModel(new i({name:"",returnType:"",entitySet:"",method:"GET",parameters:[]},true),"selectedFunction");this.getView().setModel(new i([],true),"entityFilters");this.getView().setModel(new i([],true),"entitySorting");this.getVie+
w().setModel(new i([],true),"requestHistory");this.getView().setModel(new i([],true),"requestHeaders")},handleInit:async function e(){await this.getGlobalModel().dataLoaded();this.setBusy(true);const t=this.getOwnerComponent().getModel();await t.metadata+
Loaded(true);t.setSizeLimit(M.SERVICE_QUERY_LIMIT);this.setBusy(false);if(!u.support.websocket){o.show("Note: WebSocket not supported")}},onSelectService:function e(){void this.handleServiceSelection()},onSelectEntity:function e(){this.handleEntityChange+
d()},onSelectFunction:function e(){this.handleFunctionChanged()},onAddFilterButtonPress:function e(){void this.handleAddFilter()},onAddSortButtonPress:function e(){void this.handleAddSort()},onButtonSortDeletePress:function e(t){const s=t.getSource().get+
BindingContext("entitySorting");const i=s.getObject();void this.handleButtonSortDeletePress(i)},onSendRequest:function e(){this.clearResult();if(this.localData.resourceType==="entity"){switch(this.localData.selectedMethod){case"GET":void this.execEntityR+
ead();break;case"GETBY":void this.execEntityGetSingle();break;case"POST":void this.execEntityCreate();break;case"DELETE":void this.execEntityDelete();break}}else if(this.localData.resourceType==="function"){void this.execFunctionRequest()}else{throw new +
Error(`Unknown resource type: ${this.localData.resourceType}`)}},onShowMetadata:function e(){const t=this.odataClient?.getMetadataText();void this.component.dialogManager.showXmlCodeEditor(t)},onAddHeader:function e(){void this.handleAddHeader()},onButto+
nSaveConfigurationPress:function e(){void this.handleSaveConfiguration()},onButtonLoadConfigurationPress:function e(){void this.handleLoadConfiguration()},handleServiceSelection:async function e(){const t=await this.pickService();await this.loadService(t+
)},loadService:async function e(t){this.setBusy(true);try{this.selectedService.service=t;this.setTitle(t.ServiceName);this.localData.selectedEntityName="";this.localData.selectedFunctionName="";this.localData.selectedServiceFunctions=[];this.localData.re+
sourceType="entity";this.localData.selectedMethod="GET";this.odataClient?.destroy();this.odataClient=undefined;switch(t.ODataType){case"2":this.odataClient=new B(t.ServicePath);break;case"4":this.odataClient=new C(t.ServicePath);break;default:o.show("Ser+
vice Type not supported");break}await this.odataClient.initAsync();this.handleServiceSelected()}finally{this.setBusy(false)}},handleServiceSelected:function e(){this.setBusy(true);try{this.resetFilters();this.resetSorting();this.resetEntityInputs();this.+
selectedService.entities=this.odataClient?.getEntities()||[];this.localData.selectedServiceFunctions=this.odataClient?.getFunctions()||[];this.localData.selectedServiceActions=this.odataClient?.getActions()||[];this.localData.entityCount=this.selectedSer+
vice.entities.length;this.localData.functionCount=this.localData.selectedServiceFunctions.length;this.localData.actionCount=this.localData.selectedServiceActions.length;if(this.selectedService.entities.length>0){this.localData.selectedEntityName=this.sel+
ectedService.entities[0].name;this.handleEntityChanged()}if(this.localData.selectedServiceFunctions.length>0){this.localData.selectedFunctionName=this.localData.selectedServiceFunctions[0].name;this.handleFunctionChanged()}}finally{this.setBusy(false)}},+
pickService:async function e(){this.setBusy(true);try{const e=await this.component.requests.getServices();return await this.component.dialogManager.pickService(e)}finally{this.setBusy(false)}},handleEntityChanged:function e(){this.resetFilters();this.res+
etSorting();this.resetEntityInputs();const t=this.selectedService.entities.find(e=>e.name===this.localData.selectedEntityName)?.properties;this.localData.selectedEntityProperties.properties=t||[];this.localData.selectedEntityProperties.keyProperties=this+
.selectedService.entities.find(e=>e.name===this.localData.selectedEntityName)?.keys||[];this.localData.selectedEntityProperties.properties=this.localData.selectedEntityProperties.properties.filter(e=>!this.localData.selectedEntityProperties.keyProperties+
.some(t=>t.name===e.name))},handleFunctionChanged:function e(){this.resetFunctionInputs();const t=this.localData.selectedServiceFunctions.find(e=>e.name===this.localData.selectedFunctionName);this.getView().getModel("selectedFunction").setProperty("/",t)+
},execEntityCreate:async function e(){this.setBusy(true);try{const e=this.getEntityPropertyValues();const t=e.keyProperties;const s={...e.properties,...t};await(this.odataClient?.createEntity(this.localData.selectedEntityName,s));this.localData.response=+
"";o.show("Entity created")}catch(e){c.error(e.toString())}finally{this.setBusy(false)}},execEntityDelete:async function e(){this.setBusy(true);try{const e=this.getEntityPropertyValues();if(Object.values(e.keyProperties).some(e=>e==="")){c.error("Please +
enter value for key properties: "+Object.keys(e.keyProperties).join(", "));this.setBusy(false);return}await(this.odataClient?.deleteEntity(this.localData.selectedEntityName,e.keyProperties));this.localData.response="";o.show("Entity deleted")}finally{thi+
s.setBusy(false)}},execEntityGetSingle:async function e(){this.setBusy(true);try{const e=this.getEntityPropertyValues();if(Object.values(e.keyProperties).some(e=>e==="")){const t=Object.keys(e.keyProperties).filter(t=>e.keyProperties[t]==="");c.error("Pl+
ease enter value for key properties: "+t.join(", "));this.setBusy(false);return}const t=await(this.odataClient?.getEntity(this.localData.selectedEntityName,e.keyProperties));this.localData.response=JSON.stringify(t,null,2);this.setTableResponse(t)}finall+
y{this.setBusy(false)}},execEntityRead:async function e(){this.setBusy(true);const t=this.getHeaders();const s=this.getView().getModel("entityFilters").getProperty("/");const i=this.getView().getModel("entitySorting").getProperty("/");try{const e=await(t+
his.odataClient?.readEntity({entityName:this.localData.selectedEntityName,filters:s.map(e=>new p(e.property,e.operator,e.value)),sorting:i.map(e=>new P(e.property,e.direction==="desc")),headers:t,top:this.localData.top,skip:this.localData.skip}));this.lo+
calData.response=JSON.stringify(e,null,2);this.setTableResponse(e);const n=this.getView().getModel("requestHistory").getProperty("/");n.push({method:"READ",entity:this.localData.selectedEntityName,timestamp:(new Date).toISOString(),statusCode:200,respons+
e:this.localData.response});this.getView().getModel("requestHistory").setProperty("/",n)}finally{this.setBusy(false)}},getResultTable:function e(){return this.getById("idResponseTable")},clearResult:function e(){const t=this.getResultTable();t.removeAllC+
olumns();t.removeAllItems();this.localData.response=""},setTableResponse:function e(t){const s=this.getById("idResponseTable");const i={...this.localData.selectedEntityProperties.properties,...this.localData.selectedEntityProperties.keyProperties};const +
n=[];const o=Object.keys(i);for(const e of o){n.push({name:i[e].name,isKey:this.localData.selectedEntityProperties.keyProperties.some(t=>t.name===i[e].name)})}let r=[];if(Array.isArray(t)){r=t}else if(t&&typeof t==="object"){const e=t;if("results"in e&&A+
rray.isArray(e.results)){r=e.results}else{r=[e]}}if(r.length===0){return}for(const e of n){const t=e.name;let i=t.length;r.forEach(t=>{const s=t[e.name];let n="";if(s!==null&&s!==undefined){if(typeof s==="object"){n=JSON.stringify(s,null,2)}else{n=String+
(s)}}i=Math.max(i,n.length)});const n=i*10+16;const o=new l({items:[new w({items:[e.isKey?new v({src:"sap-icon://key"}).addStyleClass("sapUiTinyMarginEnd"):null,new m({text:t})].filter(Boolean),alignItems:"Center"})]});s.addColumn(new f({header:o,width:`+
${n}px`}))}for(const e of r){const t=n.map(t=>{const s=e[t.name];let i="";if(s!==null&&s!==undefined){if(typeof s==="object"){i=JSON.stringify(s,null,2)}else{i=String(s)}}return new m({text:i})});s.addItem(new S({cells:t}))}},execFunctionRequest:async fu+
nction e(){this.setBusy(true);try{const e=this.getView().getModel("selectedFunction").getProperty("/");const t=this.getFunctionParameterValues();const s=await(this.odataClient?.executeFunction({functionName:e.name,parameters:t,method:e.method}));this.loc+
alData.response=JSON.stringify(s,null,2)}finally{this.setBusy(false)}},resetFilters:function e(){this.getView().getModel("entityFilters").setProperty("/",[])},resetSorting:function e(){this.getView().getModel("entitySorting").setProperty("/",[])},handleA+
ddFilter:async function e(){const t=this.selectedService.entities.find(e=>e.name===this.localData.selectedEntityName);if(!t){c.error("Entity not found");return}const s=await this.component.dialogManager.addFilter(t.properties);const i=this.getView().getM+
odel("entityFilters").getProperty("/");const n=i.find(e=>e.property===s.property&&e.operator===s.operator&&e.value===s.value);if(n){c.error("Conflict with existing record");return}i.push(s);this.getView().getModel("entityFilters").setProperty("/",i)},han+
dleAddHeader:async function e(){const t=await this.component.dialogManager.showAddHeaderDialog();const s=this.getView().getModel("requestHeaders").getProperty("/");const i=s.find(e=>e.key===t.key);if(i){c.error(`Header with key ${t.key} already exists. P+
lease use a different key.`)}else{s.push({key:t.key,value:t.value});this.getView().getModel("requestHeaders").setProperty("/",s)}},onEditHeader:function e(i){const r=i.getSource().getBindingContext("requestHeaders");const c=this.getView().getModel("reque+
stHeaders").getProperty("/");const d=r.getObject();const u=()=>{if(h.getValue()===""){o.show("Please enter a value.");return}const e=c.findIndex(e=>e.key===d.key);if(e>-1){c[e].value=h.getValue();this.getView().getModel("requestHeaders").setProperty("/",+
c)}y.close();y.destroy()};const h=new a({value:d.value,submit:u});const y=new t({title:"Edit Value of "+d.key,contentWidth:"400px",content:[new l({items:[new n({text:"Value"}),h.addStyleClass("sapUiSmallMarginBottom")]}).addStyleClass("sapUiSmallMargin")+
]});y.setBeginButton(new s({text:"Save",press:u,type:"Emphasized",icon:"sap-icon://accept"}));y.setEndButton(new s({text:"Cancel",press:()=>{y.close();y.destroy()},type:"Ghost",icon:"sap-icon://decline"}));y.open();h.selectText(0,d.value.length)},onDelet+
eHeader:function e(t){const s=t.getSource().getBindingContext("requestHeaders");const i=s.getObject();const n=this.getView().getModel("requestHeaders").getProperty("/");const o=n.findIndex(e=>e.key===i.key);if(o>-1){n.splice(o,1)}this.getView().getModel(+
"requestHeaders").setProperty("/",n)},getHeaders:function e(){const t={};const s=this.getView().getModel("requestHeaders").getProperty("/");s.forEach(e=>{t[e.key]=e.value});return t},onCopyTodpupboard:function e(){void this.handleCopy()},handleCopy:async+
 function e(){const t=this.localData.response;if(t){await V.copy2Clipboard(t);o.show("Response copied to clipboard")}else{o.show("No response to copy")}},onInputPropertyChange:function e(t){const s=t.getSource();const i=s.getName();const n=s.getValue();t+
his.values[i]=n},getById:function e(t){const s=this.fragmentId;const i=`${s}--${t}`;const n=g.byId(i);return n},getFunctionParameterValues:function e(){const t=this.getById("idParametersVBox");const s=V.getAllInputValues(t);return s},getEntityPropertyVal+
ues:function e(){const t=this.getById("idPropertiesVBox");const s=this.getById("idKeyPropertiesVBox");const i=V.getAllInputValues(t);const n=V.getAllInputValues(s);return{properties:i,keyProperties:n}},resetEntityInputs:function e(){const t=this.getById(+
"idPropertiesVBox");const s=this.getById("idKeyPropertiesVBox");V.resetInputs(t);V.resetInputs(s)},resetFunctionInputs:function e(){const t=this.getById("idParametersVBox");V.resetInputs(t)},onButtonFilterDeletePress:function e(t){const s=t.getSource().g+
etBindingContext("entityFilters");const i=s.getObject();void this.handleButtonFilterDeletePress(i)},onButtonFilterEditPress:function e(t){const s=t.getSource().getBindingContext("entityFilters");const i=s.getObject();void this.handleButtonFilterEditPress+
(i)},handleButtonFilterDeletePress:function e(t){const s=this.getView().getModel("entityFilters").getProperty("/");const i=s.filter(e=>e.property!==t.property&&e.operator!==t.operator&&e.value!==t.value);this.getView().getModel("entityFilters").setProper+
ty("/",i)},handleButtonFilterEditPress:async function e(t){const s=this.selectedService.entities.find(e=>e.name===this.localData.selectedEntityName);if(!s){c.error("Entity not found");return}const i=this.getView().getModel("entityFilters").getProperty("/+
");const n=i.findIndex(e=>e.property===t.property&&e.operator===t.operator&&e.value===t.value);const o=await this.component.dialogManager.editFilter(t,s.properties);const r=i.find(e=>e.property===o.property&&e.operator===o.operator&&e.value===o.value);if+
(r){c.error("Conflict with existing record");return}i[n]=o;this.getView().getModel("entityFilters").setProperty("/",i)},onButtonViewResponsePress:function e(t){const s=t.getSource().getBindingContext("requestHistory");const i=s.getObject();this.localData+
.response=i.response},handleAddSort:async function e(){const t=this.selectedService.entities.find(e=>e.name===this.localData.selectedEntityName);if(!t){c.error("Entity not found");return}const s=await this.component.dialogManager.addSort(t.properties);co+
nst i=this.getView().getModel("entitySorting").getProperty("/");const n=i.find(e=>e.property===s.property);if(n){c.error("Property already sorted");return}i.push(s);this.getView().getModel("entitySorting").setProperty("/",i)},handleButtonSortDeletePress:+
function e(t){const s=this.getView().getModel("entitySorting").getProperty("/");const i=s.filter(e=>e.property!==t.property);this.getView().getModel("entitySorting").setProperty("/",i)},handleSaveConfiguration:async function e(){this.setBusy(true);try{co+
nst e=await this.component.dialogManager.showSaveProjectDialog();const t=this.getView().getModel("local").getProperty("/");const s=this.getView().getModel("entityFilters").getProperty("/");const i=this.getView().getModel("requestHeaders").getProperty("/"+
);const n=this.getView().getModel("entitySorting").getProperty("/");const r=this.getView().getModel("selectedService").getProperty("/");const a={ProjectName:e,Odatatype:r.service.ODataType,ServiceName:r.service.ServiceName,ServicePath:r.service.ServicePa+
th,ServiceVersion:r.service.Version,EntityMethod:t.selectedMethod,EntityName:t.selectedEntityName,FunctionName:t.selectedFunctionName,ActionName:"",RequestType:t.resourceType,Top:t.top??0,Skip:t.skip??0,Headers:JSON.stringify(i),Filters:JSON.stringify(s)+
,Sorters:JSON.stringify(n)};await this.component.requests.createProject(a);o.show("Configuration saved successfully")}finally{this.setBusy(false)}},handleLoadConfiguration:async function e(){try{const e=await this.component.dialogManager.showProjectListD+
ialog();if(e){const t=this.getView().getModel("local").getProperty("/");const s={ServiceName:e.ServiceName,ODataType:e.Odatatype,ServicePath:e.ServicePath,Version:e.ServiceVersion};await this.loadService(s);t.resourceType=e.RequestType;t.selectedEntityNa+
me=e.EntityName;t.selectedFunctionName=e.FunctionName;t.selectedMethod=e.EntityMethod;t.top=e.Top?e.Top:10;t.skip=e.Skip?e.Skip:0;this.getView().getModel("local").setProperty("/",t);this.getView().getModel("entityFilters").setProperty("/",JSON.parse(e.Fi+
lters));this.getView().getModel("entitySorting").setProperty("/",JSON.parse(e.Sorters));this.getView().getModel("requestHeaders").setProperty("/",JSON.parse(e.Headers));o.show("Configuration loaded successfully")}}catch(e){if(e instanceof Error&&e.messag+
e!=="Dialog closed"){c.error(`Error loading configuration: ${e.message}`)}}},setTitle:function e(t){throw new Error("Not implemented: "+t)}});return F});                                                                                                      
//# sourceMappingURL=OData.controller.js.map                                                                                                                                                                                                                   