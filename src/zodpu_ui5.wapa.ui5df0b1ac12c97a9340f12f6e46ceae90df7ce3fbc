sap.ui.define(["../../util/DialogController", "sap/ui/model/Filter", "sap/ui/model/FilterOperator", "sap/m/MessageToast"], function (__DialogController, Filter, FilterOperator, MessageToast) {                                                               
  "use strict";                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
  function _interopRequireDefault(obj) {                                                                                                                                                                                                                       
    return obj && obj.__esModule && typeof obj.default !== "undefined" ? obj.default : obj;                                                                                                                                                                    
  }                                                                                                                                                                                                                                                            
  const DialogController = _interopRequireDefault(__DialogController);                                                                                                                                                                                         
  /**                                                                                                                                                                                                                                                          
   * @namespace de.kernich.odpu.controller.dialog                                                                                                                                                                                                              
   */                                                                                                                                                                                                                                                          
  const PickServiceDialogController = DialogController.extend("de.kernich.odpu.controller.dialog.PickServiceDialogController", {                                                                                                                               
    constructor: function constructor() {                                                                                                                                                                                                                      
      DialogController.prototype.constructor.apply(this, arguments);                                                                                                                                                                                           
      this.data = {                                                                                                                                                                                                                                            
        services: [],                                                                                                                                                                                                                                          
        odataTypes: [{                                                                                                                                                                                                                                         
          key: "ALL",                                                                                                                                                                                                                                          
          text: "All"                                                                                                                                                                                                                                          
        }, {                                                                                                                                                                                                                                                   
          key: "2",                                                                                                                                                                                                                                            
          text: "2"                                                                                                                                                                                                                                            
        }, {                                                                                                                                                                                                                                                   
          key: "4",                                                                                                                                                                                                                                            
          text: "4"                                                                                                                                                                                                                                            
        }],                                                                                                                                                                                                                                                    
        searchQuery: "",                                                                                                                                                                                                                                       
        selectedODataType: "ALL",                                                                                                                                                                                                                              
        selectedService: null                                                                                                                                                                                                                                  
      };                                                                                                                                                                                                                                                       
    },                                                                                                                                                                                                                                                         
    onSearch: function _onSearch(event) {                                                                                                                                                                                                                      
      const query = event.getParameter("newValue")?.toLowerCase() ?? "";                                                                                                                                                                                       
      const table = this.getElement("idServicesTable");                                                                                                                                                                                                        
      const binding = table.getBinding("items");                                                                                                                                                                                                               
      binding.filter(query ? new Filter({                                                                                                                                                                                                                      
        filters: [new Filter("ServiceName", FilterOperator.Contains, query), new Filter("ServicePath", FilterOperator.Contains, query)],                                                                                                                       
        and: false                                                                                                                                                                                                                                             
      }) : []);                                                                                                                                                                                                                                                
      const filteredLength = binding ? binding.getLength() : 0;                                                                                                                                                                                                
      this.dialog.setTitle(`Select Service (${filteredLength})`);                                                                                                                                                                                              
    },                                                                                                                                                                                                                                                         
    onODataTypeChange: function _onODataTypeChange(event) {                                                                                                                                                                                                    
      const selectedKey = event.getParameter("selectedItem")?.getKey() ?? "ALL";                                                                                                                                                                               
      this.data.selectedODataType = selectedKey;                                                                                                                                                                                                               
      this.applyFilters();                                                                                                                                                                                                                                     
    },                                                                                                                                                                                                                                                         
    onRefresh: function _onRefresh() {                                                                                                                                                                                                                         
      void this.handleRefresh();                                                                                                                                                                                                                               
    },                                                                                                                                                                                                                                                         
    handleRefresh: async function _handleRefresh() {                                                                                                                                                                                                           
      const model = this.getModel("dialog");                                                                                                                                                                                                                   
      const services = await this.requests.getServices();                                                                                                                                                                                                      
      model.setProperty("/services", services);                                                                                                                                                                                                                
      MessageToast.show(this.getText("msg.servicesRefreshed"));                                                                                                                                                                                                
    },                                                                                                                                                                                                                                                         
    onChoose: function _onChoose() {                                                                                                                                                                                                                           
      const table = this.getElement("idServicesTable");                                                                                                                                                                                                        
      const selectedItem = table.getSelectedItem();                                                                                                                                                                                                            
      if (!selectedItem) {                                                                                                                                                                                                                                     
        MessageToast.show(this.getText("msg.selectService"));                                                                                                                                                                                                  
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
      const bindingContext = selectedItem.getBindingContext("dialog");                                                                                                                                                                                         
      const service = bindingContext.getObject();                                                                                                                                                                                                              
      this.data.selectedService = service;                                                                                                                                                                                                                     
      this.onConfirm();                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    onCustomService: async function _onCustomService() {                                                                                                                                                                                                       
      try {                                                                                                                                                                                                                                                    
        const service = await this.dialogManager.pickCustomService();                                                                                                                                                                                          
        this.data.selectedService = service;                                                                                                                                                                                                                   
        this.onConfirm();                                                                                                                                                                                                                                      
      } catch {                                                                                                                                                                                                                                                
        // Ignore error as it's handled in pickCustomService                                                                                                                                                                                                   
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    applyFilters: function _applyFilters() {                                                                                                                                                                                                                   
      const table = this.getElement("idServicesTable");                                                                                                                                                                                                        
      const binding = table.getBinding("items");                                                                                                                                                                                                               
      const filters = [];                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
      // Add search filter if query exists                                                                                                                                                                                                                     
      if (this.data.searchQuery) {                                                                                                                                                                                                                             
        filters.push(new Filter("ServiceName", FilterOperator.Contains, this.data.searchQuery), new Filter("ServicePath", FilterOperator.Contains, this.data.searchQuery));                                                                                    
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      // Add OData type filter if not ALL                                                                                                                                                                                                                      
      if (this.data.selectedODataType !== "ALL") {                                                                                                                                                                                                             
        filters.push(new Filter("ODataType", FilterOperator.EQ, this.data.selectedODataType));                                                                                                                                                                 
      }                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      // Apply combined filters                                                                                                                                                                                                                                
      binding.filter(filters.length > 0 ? new Filter({                                                                                                                                                                                                         
        filters: filters,                                                                                                                                                                                                                                      
        and: true                                                                                                                                                                                                                                              
      }) : []);                                                                                                                                                                                                                                                
      const filteredLength = binding ? binding.getLength() : 0;                                                                                                                                                                                                
      this.dialog.setTitle(`Select Service (${filteredLength})`);                                                                                                                                                                                              
    },                                                                                                                                                                                                                                                         
    onFavorite: function _onFavorite(isFavorite, event) {                                                                                                                                                                                                      
      const binding = event.getSource().getBindingContext("dialog");                                                                                                                                                                                           
      const service = binding.getObject();                                                                                                                                                                                                                     
      void this.handleFavorite(service, isFavorite);                                                                                                                                                                                                           
    },                                                                                                                                                                                                                                                         
    handleFavorite: async function _handleFavorite(service, isFavorite) {                                                                                                                                                                                      
      this.dialog.setBusy(true);                                                                                                                                                                                                                               
      try {                                                                                                                                                                                                                                                    
        await this.requests.markAsFavorite({                                                                                                                                                                                                                   
          servicePath: service.ServicePath,                                                                                                                                                                                                                    
          isFavorite: isFavorite                                                                                                                                                                                                                               
        });                                                                                                                                                                                                                                                    
        await this.handleRefresh();                                                                                                                                                                                                                            
      } finally {                                                                                                                                                                                                                                              
        this.dialog.setBusy(false);                                                                                                                                                                                                                            
      }                                                                                                                                                                                                                                                        
    }                                                                                                                                                                                                                                                          
  });                                                                                                                                                                                                                                                          
  return PickServiceDialogController;                                                                                                                                                                                                                          
});                                                                                                                                                                                                                                                            
//# sourceMappingURL=PickServiceDialogController-dbg.js.map                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               