{"version":3,"file":"OData4Client.js","names":["ODataHelper","_interopRequireDefault","__ODataHelper","OData4Client","constructor","serviceUrl","escapedServiceUrl","endsWith","this","model","ODataModelV4","synchronizationMode","earlyRequests","httpHeader+
s","attachDataReceived","event","parameters","getParameters","error","status","message","requestUrl","MessageBox","getActions","actions","actionNodes","Array","from","metadataXml","getElementsByTagName","map","node","Name","getAttribute","IsBound","Param+
eters","paramNode","Type","Nullable","action","push","name","isBound","param","type","nullable","destroy","createEntity","options","binding","bindList","entityName","undefined","$$getKeepAliveContext","createdContext","create","properties","created","del+
eteEntity","keyPath","Object","entries","keys","_ref","key","value","join","entityBinding","getKeepAliveContext","delete","getEntity","_ref2","bindContext","obj","requestObject","Error","getEntities","entities","entitySets","EntityType","entity","entityT+
ype","includes","split","pop","entityTypeNode","find","propertyNode","maxLength","getMaxLength","keyNode","propertyRefs","property","getFunctions","functionImports","ReturnType","EntitySet","HttpMethod","func","returnType","entitySet","method","readEntit+
y","contexts","requestContexts","context","getObject","getModel","getMetadataText","metadataText","getMetadataXml","initAsync","parseMetadataXml","executeFunction","executeAction"],"sources":["OData4Client.ts"],"sourcesContent":["import Filter from \"sap+
/ui/model/Filter\";\nimport IODataClient from \"./IODataClient\";\nimport ODataModel from \"sap/ui/model/odata/ODataModel\";\nimport ODataModelV4, {\n\tODataModel$DataReceivedEvent,\n} from \"sap/ui/model/odata/v4/ODataModel\";\nimport {\n\tMetadataActio+
n,\n\tMetadataEntity,\n\tMetadataFunction,\n\tMetadataFunctionMethod,\n} from \"../Types\";\nimport ODataHelper from \"./ODataHelper\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport Sorter from \"sap/ui/model/Sorter\";\n\n/**\n * @namespace de.ke+
rnich.odpu.util\n */\nexport default class OData4Client implements IODataClient {\n\tprivate model: ODataModelV4;\n\tprivate serviceUrl: string;\n\tprivate metadataText: string;\n\tprivate metadataXml: XMLDocument;\n\tconstructor(serviceUrl: string) {\n\+
t\tlet escapedServiceUrl = serviceUrl;\n\t\tif (!escapedServiceUrl.endsWith(\"/\")) {\n\t\t\tescapedServiceUrl += \"/\";\n\t\t}\n\t\tthis.serviceUrl = escapedServiceUrl;\n\t\tthis.model = new ODataModelV4({\n\t\t\tserviceUrl: escapedServiceUrl,\n\t\t\tsy+
nchronizationMode: \"None\",\n\t\t\tearlyRequests: true,\n\t\t\thttpHeaders: {},\n\t\t});\n\n\t\tthis.model.attachDataReceived({}, (event: ODataModel$DataReceivedEvent) => {\n\t\t\tconst parameters = event.getParameters() as unknown as {\n\t\t\t\terror?:+
 {\n\t\t\t\t\terror: {\n\t\t\t\t\t\tcode: string;\n\t\t\t\t\t\tmessage: string;\n\t\t\t\t\t};\n\t\t\t\t\tmessage: string;\n\t\t\t\t\tstatus: number;\n\t\t\t\t\trequestUrl: string;\n\t\t\t\t};\n\t\t\t\tdata?: object;\n\t\t\t};\n\t\t\tif (parameters.error?+
.status >= 400) {\n\t\t\t\tconst message =\n\t\t\t\t\t\"Requested failed: \" +\n\t\t\t\t\tparameters.error.requestUrl +\n\t\t\t\t\t\"\\n\\nMessage: \" +\n\t\t\t\t\tparameters.error.message;\n\t\t\t\tMessageBox.error(message);\n\t\t\t}\n\t\t});\n\t}\n\tge+
tActions(): MetadataAction[] {\n\t\tconst actions: MetadataAction[] = [];\n\n\t\tconst actionNodes = Array.from(\n\t\t\tthis.metadataXml.getElementsByTagName(\"Action\")\n\t\t).map((node) => ({\n\t\t\tName: node.getAttribute(\"Name\"),\n\t\t\tIsBound: no+
de.getAttribute(\"IsBound\"),\n\t\t\tParameters: Array.from(node.getElementsByTagName(\"Parameter\")).map(\n\t\t\t\t(paramNode) => ({\n\t\t\t\t\tName: paramNode.getAttribute(\"Name\"),\n\t\t\t\t\tType: paramNode.getAttribute(\"Type\"),\n\t\t\t\t\tNullabl+
e: paramNode.getAttribute(\"Nullable\"),\n\t\t\t\t})\n\t\t\t),\n\t\t}));\n\n\t\tfor (const action of actionNodes) {\n\t\t\tactions.push({\n\t\t\t\tname: action.Name,\n\t\t\t\tisBound: action.IsBound === \"true\",\n\t\t\t\tparameters: action.Parameters.ma+
p((param) => ({\n\t\t\t\t\tname: param.Name,\n\t\t\t\t\ttype: param.Type,\n\t\t\t\t\tnullable: param.Nullable === \"true\",\n\t\t\t\t})),\n\t\t\t});\n\t\t}\n\n\t\treturn actions;\n\t}\n\tdestroy(): void {}\n\n\tasync createEntity(\n\t\toptions: {\n\t\t\t+
entityName: string;\n\t\t\tproperties: Record<string, unknown>;\n\t\t\theaders: Record<string, string>;\n\t\t}\n\t) {\n\t\tconst binding = this.model.bindList(`/${options.entityName}`, undefined, [], [], {\n\t\t\t$$getKeepAliveContext: true,\n\t\t});\n\n+
\t\tconst createdContext = binding.create(options.properties);\n\n\t\tawait createdContext.created();\n\t}\n\tdeleteEntity(\n\t\toptions: {\n\t\t\tentityName: string;\n\t\t\tkeys: Record<string, string | number | boolean>;\n\t\t\theaders: Record<string, +
string>;\n\t\t}\n\t) {\n\t\tconst keyPath = Object.entries(options.keys)\n\t\t\t.map(([key, value]) => `${key}='${value}'`)\n\t\t\t.join(\",\");\n\t\tconst entityBinding = this.model.getKeepAliveContext(\n\t\t\t`/${options.entityName}(${keyPath})`\n\t\t)+
;\n\n\t\treturn entityBinding.delete();\n\t}\n\tasync getEntity(\n\t\toptions: {\n\t\t\tentityName: string;\n\t\t\tkeys: Record<string, string | number | boolean>;\n\t\t\theaders: Record<string, string>;\n\t\t}\n\t): Promise<object> {\n\t\tconst keyPath +
= Object.entries(options.keys)\n\t\t\t.map(([key, value]) => `${key}='${value}'`)\n\t\t\t.join(\",\");\n\t\tconst binding = this.model.bindContext(`/${options.entityName}(${keyPath})`);\n\t\tconst obj = (await binding.requestObject()) as object;\n\t\tif +
(obj === undefined) {\n\t\t\tthrow new Error(\"Entity not found\");\n\t\t}\n\t\treturn obj;\n\t}\n\tgetEntities(): MetadataEntity[] {\n\t\tconst entities: MetadataEntity[] = [];\n\n\t\tconst entitySets = Array.from(\n\t\t\tthis.metadataXml.getElementsByT+
agName(\"EntitySet\")\n\t\t).map((node) => ({\n\t\t\tName: node.getAttribute(\"Name\"),\n\t\t\tEntityType: node.getAttribute(\"EntityType\"),\n\t\t}));\n\n\t\tfor (const entity of entitySets) {\n\t\t\tlet entityType = entity.EntityType;\n\t\t\tif (entity+
Type.includes(\".\")) {\n\t\t\t\tentityType = entityType.split(\".\").pop();\n\t\t\t}\n\t\t\tconst entityTypeNode = Array.from(\n\t\t\t\tthis.metadataXml.getElementsByTagName(\"EntityType\")\n\t\t\t).find((node) => {\n\t\t\t\treturn node.getAttribute(\"N+
ame\") === entityType;\n\t\t\t});\n\t\t\tconst properties = Array.from(\n\t\t\t\tentityTypeNode.getElementsByTagName(\"Property\")\n\t\t\t).map((propertyNode) => ({\n\t\t\t\tname: propertyNode.getAttribute(\"Name\"),\n\t\t\t\ttype: propertyNode.getAttrib+
ute(\"Type\"),\n\t\t\t\tnullable: propertyNode.getAttribute(\"Nullable\"),\n\t\t\t\tmaxLength: ODataHelper.getMaxLength(\n\t\t\t\t\tpropertyNode.getAttribute(\"MaxLength\")\n\t\t\t\t),\n\t\t\t}));\n\t\t\tconst keyNode = entityTypeNode.getElementsByTagNam+
e(\"Key\")[0];\n\n\t\t\tconst propertyRefs = Array.from(\n\t\t\t\tkeyNode.getElementsByTagName(\"PropertyRef\")\n\t\t\t).map((keyNode) => ({\n\t\t\t\tname: keyNode.getAttribute(\"Name\"),\n\t\t\t\ttype: properties.find(\n\t\t\t\t\t(property) => property.+
name === keyNode.getAttribute(\"Name\")\n\t\t\t\t).type,\n\t\t\t\tnullable: properties.find(\n\t\t\t\t\t(property) => property.name === keyNode.getAttribute(\"Name\")\n\t\t\t\t).nullable,\n\t\t\t\tmaxLength: properties.find(\n\t\t\t\t\t(property) => prop+
erty.name === keyNode.getAttribute(\"Name\")\n\t\t\t\t).maxLength,\n\t\t\t}));\n\n\t\t\tentities.push({\n\t\t\t\tname: entity.Name,\n\t\t\t\tentityType: entityType,\n\t\t\t\tproperties: properties,\n\t\t\t\tkeys: propertyRefs,\n\t\t\t});\n\t\t}\n\t\tretu+
rn entities;\n\t}\n\tgetFunctions(): MetadataFunction[] {\n\t\tconst functionImports = Array.from(\n\t\t\tthis.metadataXml.getElementsByTagName(\"FunctionImport\")\n\t\t).map((node) => ({\n\t\t\tName: node.getAttribute(\"Name\"),\n\t\t\tReturnType: node.+
getAttribute(\"ReturnType\"),\n\t\t\tEntitySet: node.getAttribute(\"EntitySet\"),\n\t\t\tHttpMethod: node.getAttribute(\"m:HttpMethod\"),\n\t\t}));\n\n\t\treturn functionImports.map((func) => {\n\t\t\tconst parameters = Array.from(\n\t\t\t\tthis.metadata+
Xml.getElementsByTagName(\"Parameter\")\n\t\t\t).map((paramNode) => ({\n\t\t\t\tname: paramNode.getAttribute(\"Name\"),\n\t\t\t\ttype: paramNode.getAttribute(\"Type\"),\n\t\t\t\tnullable: paramNode.getAttribute(\"Nullable\"),\n\t\t\t\tmaxLength: ODataHel+
per.getMaxLength(\n\t\t\t\t\tparamNode.getAttribute(\"MaxLength\")\n\t\t\t\t),\n\t\t\t}));\n\n\t\t\treturn {\n\t\t\t\tname: func.Name,\n\t\t\t\treturnType: func.ReturnType,\n\t\t\t\tentitySet: func.EntitySet,\n\t\t\t\tparameters: parameters,\n\t\t\t\tmet+
hod: func.HttpMethod as MetadataFunctionMethod,\n\t\t\t};\n\t\t});\n\t}\n\tasync readEntity(options: {\n\t\tentityName: string;\n\t\tfilters: Filter[];\n\t\tsorting: Sorter[];\n\t\theaders: Record<string, string>;\n\t\ttop: number;\n\t\tskip: number;\n\t+
}): Promise<object> {\n\t\tconst binding = this.model.bindList(\n\t\t\t\"/\" + options.entityName,\n\t\t\tundefined,\n\t\t\t[],\n\t\t\t[],\n\t\t\t{}\n\t\t);\n\t\tconst contexts = await binding.requestContexts();\n\t\treturn contexts.map((context) => cont+
ext.getObject() as object);\n\t}\n\tgetModel(): ODataModel {\n\t\treturn this.model as unknown as ODataModel;\n\t}\n\tgetMetadataText(): string {\n\t\treturn this.metadataText;\n\t}\n\tgetMetadataXml(): XMLDocument {\n\t\treturn this.metadataXml;\n\t}\n\+
tasync initAsync() {\n\t\tthis.metadataText = await ODataHelper.getMetadataText(this.serviceUrl);\n\t\tthis.metadataXml = ODataHelper.parseMetadataXml(this.metadataText);\n\t}\n\n\texecuteFunction(options: {\n\t\tfunctionName: string,\n\t\tparameters: Re+
cord<string, string | number | boolean>,\n\t\tmethod: 'GET' | 'POST'\n\t}): Promise<unknown> {\n\t\tthrow new Error(\"Not implemented\");\n\t}\n\n\texecuteAction(options: {\n\t\tactionName: string,\n\t\tparameters: Record<string, string | number | boolea+
n>,\n\t\tmethod: 'GET' | 'POST'\n\t}): Promise<unknown> {\n\t\tthrow new Error(\"Not implemented\");\n\t}\n}\n"],"mappings":"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","ignoreList":[]}                                                                                                                                                                                                