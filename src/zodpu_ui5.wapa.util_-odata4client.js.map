{"version":3,"file":"OData4Client.js","names":["ODataHelper","_interopRequireDefault","__ODataHelper","OData4Client","constructor","serviceUrl","escapedServiceUrl","endsWith","this","model","ODataModelV4","synchronizationMode","earlyRequests","httpHeader+
s","attachDataReceived","event","parameters","getParameters","error","status","message","requestUrl","MessageBox","getActions","actions","actionNodes","Array","from","metadataXml","getElementsByTagName","map","node","Name","getAttribute","IsBound","Param+
eters","paramNode","Type","Nullable","action","push","name","isBound","param","type","nullable","destroy","createEntity","options","binding","bindList","entityName","undefined","$$getKeepAliveContext","createdContext","create","properties","created","del+
eteEntity","keyPath","Object","entries","keys","key","value","join","entityBinding","getKeepAliveContext","delete","getEntity","bindContext","obj","requestObject","Error","getEntities","entities","entitySets","EntityType","entity","entityType","includes"+
,"split","pop","entityTypeNode","find","propertyNode","maxLength","getMaxLength","keyNode","propertyRefs","property","getFunctions","functionImports","ReturnType","EntitySet","HttpMethod","func","returnType","entitySet","method","readEntity","contexts","+
requestContexts","context","getObject","getModel","getMetadataText","metadataText","getMetadataXml","initAsync","parseMetadataXml","executeFunction","executeAction"],"sources":["OData4Client.ts"],"sourcesContent":["import Filter from \"sap/ui/model/Filte+
r\";\nimport IODataClient from \"./IODataClient\";\nimport ODataModel from \"sap/ui/model/odata/ODataModel\";\nimport ODataModelV4, {\n\tODataModel$DataReceivedEvent,\n} from \"sap/ui/model/odata/v4/ODataModel\";\nimport {\n\tMetadataAction,\n\tMetadataE+
ntity,\n\tMetadataFunction,\n\tMetadataFunctionMethod,\n} from \"../Types\";\nimport ODataHelper from \"./ODataHelper\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport Sorter from \"sap/ui/model/Sorter\";\n\n/**\n * @namespace de.kernich.odpu.util+
\n */\nexport default class OData4Client implements IODataClient {\n\tprivate model: ODataModelV4;\n\tprivate serviceUrl: string;\n\tprivate metadataText: string;\n\tprivate metadataXml: XMLDocument;\n\tconstructor(serviceUrl: string) {\n\t\tlet escapedS+
erviceUrl = serviceUrl;\n\t\tif (!escapedServiceUrl.endsWith(\"/\")) {\n\t\t\tescapedServiceUrl += \"/\";\n\t\t}\n\t\tthis.serviceUrl = escapedServiceUrl;\n\t\tthis.model = new ODataModelV4({\n\t\t\tserviceUrl: escapedServiceUrl,\n\t\t\tsynchronizationMo+
de: \"None\",\n\t\t\tearlyRequests: true,\n\t\t\thttpHeaders: {},\n\t\t});\n\n\t\tthis.model.attachDataReceived({}, (event: ODataModel$DataReceivedEvent) => {\n\t\t\tconst parameters = event.getParameters() as unknown as {\n\t\t\t\terror?: {\n\t\t\t\t\te+
rror: {\n\t\t\t\t\t\tcode: string;\n\t\t\t\t\t\tmessage: string;\n\t\t\t\t\t};\n\t\t\t\t\tmessage: string;\n\t\t\t\t\tstatus: number;\n\t\t\t\t\trequestUrl: string;\n\t\t\t\t};\n\t\t\t\tdata?: object;\n\t\t\t};\n\t\t\tif (parameters.error?.status >= 400)+
 {\n\t\t\t\tconst message =\n\t\t\t\t\t\"Requested failed: \" +\n\t\t\t\t\tparameters.error.requestUrl +\n\t\t\t\t\t\"\\n\\nMessage: \" +\n\t\t\t\t\tparameters.error.message;\n\t\t\t\tMessageBox.error(message);\n\t\t\t}\n\t\t});\n\t}\n\tgetActions(): Met+
adataAction[] {\n\t\tconst actions: MetadataAction[] = [];\n\n\t\tconst actionNodes = Array.from(\n\t\t\tthis.metadataXml.getElementsByTagName(\"Action\")\n\t\t).map((node) => ({\n\t\t\tName: node.getAttribute(\"Name\"),\n\t\t\tIsBound: node.getAttribute+
(\"IsBound\"),\n\t\t\tParameters: Array.from(node.getElementsByTagName(\"Parameter\")).map(\n\t\t\t\t(paramNode) => ({\n\t\t\t\t\tName: paramNode.getAttribute(\"Name\"),\n\t\t\t\t\tType: paramNode.getAttribute(\"Type\"),\n\t\t\t\t\tNullable: paramNode.ge+
tAttribute(\"Nullable\"),\n\t\t\t\t})\n\t\t\t),\n\t\t}));\n\n\t\tfor (const action of actionNodes) {\n\t\t\tactions.push({\n\t\t\t\tname: action.Name,\n\t\t\t\tisBound: action.IsBound === \"true\",\n\t\t\t\tparameters: action.Parameters.map((param) => ({+
\n\t\t\t\t\tname: param.Name,\n\t\t\t\t\ttype: param.Type,\n\t\t\t\t\tnullable: param.Nullable === \"true\",\n\t\t\t\t})),\n\t\t\t});\n\t\t}\n\n\t\treturn actions;\n\t}\n\tdestroy(): void {}\n\n\tasync createEntity(\n\t\toptions: {\n\t\t\tentityName: str+
ing;\n\t\t\tproperties: Record<string, unknown>;\n\t\t\theaders: Record<string, string>;\n\t\t}\n\t) {\n\t\tconst binding = this.model.bindList(`/${options.entityName}`, undefined, [], [], {\n\t\t\t$$getKeepAliveContext: true,\n\t\t});\n\n\t\tconst creat+
edContext = binding.create(options.properties);\n\n\t\tawait createdContext.created();\n\t}\n\tdeleteEntity(\n\t\toptions: {\n\t\t\tentityName: string;\n\t\t\tkeys: Record<string, string | number | boolean>;\n\t\t\theaders: Record<string, string>;\n\t\t}+
\n\t) {\n\t\tconst keyPath = Object.entries(options.keys)\n\t\t\t.map(([key, value]) => `${key}='${value}'`)\n\t\t\t.join(\",\");\n\t\tconst entityBinding = this.model.getKeepAliveContext(\n\t\t\t`/${options.entityName}(${keyPath})`\n\t\t);\n\n\t\treturn+
 entityBinding.delete();\n\t}\n\tasync getEntity(\n\t\toptions: {\n\t\t\tentityName: string;\n\t\t\tkeys: Record<string, string | number | boolean>;\n\t\t\theaders: Record<string, string>;\n\t\t}\n\t): Promise<object> {\n\t\tconst keyPath = Object.entrie+
s(options.keys)\n\t\t\t.map(([key, value]) => `${key}='${value}'`)\n\t\t\t.join(\",\");\n\t\tconst binding = this.model.bindContext(`/${options.entityName}(${keyPath})`);\n\t\tconst obj = (await binding.requestObject()) as object;\n\t\tif (obj === undefi+
ned) {\n\t\t\tthrow new Error(\"Entity not found\");\n\t\t}\n\t\treturn obj;\n\t}\n\tgetEntities(): MetadataEntity[] {\n\t\tconst entities: MetadataEntity[] = [];\n\n\t\tconst entitySets = Array.from(\n\t\t\tthis.metadataXml.getElementsByTagName(\"Entity+
Set\")\n\t\t).map((node) => ({\n\t\t\tName: node.getAttribute(\"Name\"),\n\t\t\tEntityType: node.getAttribute(\"EntityType\"),\n\t\t}));\n\n\t\tfor (const entity of entitySets) {\n\t\t\tlet entityType = entity.EntityType;\n\t\t\tif (entityType.includes(\+
".\")) {\n\t\t\t\tentityType = entityType.split(\".\").pop();\n\t\t\t}\n\t\t\tconst entityTypeNode = Array.from(\n\t\t\t\tthis.metadataXml.getElementsByTagName(\"EntityType\")\n\t\t\t).find((node) => {\n\t\t\t\treturn node.getAttribute(\"Name\") === enti+
tyType;\n\t\t\t});\n\t\t\tconst properties = Array.from(\n\t\t\t\tentityTypeNode.getElementsByTagName(\"Property\")\n\t\t\t).map((propertyNode) => ({\n\t\t\t\tname: propertyNode.getAttribute(\"Name\"),\n\t\t\t\ttype: propertyNode.getAttribute(\"Type\"),\+
n\t\t\t\tnullable: propertyNode.getAttribute(\"Nullable\"),\n\t\t\t\tmaxLength: ODataHelper.getMaxLength(\n\t\t\t\t\tpropertyNode.getAttribute(\"MaxLength\")\n\t\t\t\t),\n\t\t\t}));\n\t\t\tconst keyNode = entityTypeNode.getElementsByTagName(\"Key\")[0];\+
n\n\t\t\tconst propertyRefs = Array.from(\n\t\t\t\tkeyNode.getElementsByTagName(\"PropertyRef\")\n\t\t\t).map((keyNode) => ({\n\t\t\t\tname: keyNode.getAttribute(\"Name\"),\n\t\t\t\ttype: properties.find(\n\t\t\t\t\t(property) => property.name === keyNod+
e.getAttribute(\"Name\")\n\t\t\t\t).type,\n\t\t\t\tnullable: properties.find(\n\t\t\t\t\t(property) => property.name === keyNode.getAttribute(\"Name\")\n\t\t\t\t).nullable,\n\t\t\t\tmaxLength: properties.find(\n\t\t\t\t\t(property) => property.name === k+
eyNode.getAttribute(\"Name\")\n\t\t\t\t).maxLength,\n\t\t\t}));\n\n\t\t\tentities.push({\n\t\t\t\tname: entity.Name,\n\t\t\t\tentityType: entityType,\n\t\t\t\tproperties: properties,\n\t\t\t\tkeys: propertyRefs,\n\t\t\t});\n\t\t}\n\t\treturn entities;\n\+
t}\n\tgetFunctions(): MetadataFunction[] {\n\t\tconst functionImports = Array.from(\n\t\t\tthis.metadataXml.getElementsByTagName(\"FunctionImport\")\n\t\t).map((node) => ({\n\t\t\tName: node.getAttribute(\"Name\"),\n\t\t\tReturnType: node.getAttribute(\"+
ReturnType\"),\n\t\t\tEntitySet: node.getAttribute(\"EntitySet\"),\n\t\t\tHttpMethod: node.getAttribute(\"m:HttpMethod\"),\n\t\t}));\n\n\t\treturn functionImports.map((func) => {\n\t\t\tconst parameters = Array.from(\n\t\t\t\tthis.metadataXml.getElements+
ByTagName(\"Parameter\")\n\t\t\t).map((paramNode) => ({\n\t\t\t\tname: paramNode.getAttribute(\"Name\"),\n\t\t\t\ttype: paramNode.getAttribute(\"Type\"),\n\t\t\t\tnullable: paramNode.getAttribute(\"Nullable\"),\n\t\t\t\tmaxLength: ODataHelper.getMaxLengt+
h(\n\t\t\t\t\tparamNode.getAttribute(\"MaxLength\")\n\t\t\t\t),\n\t\t\t}));\n\n\t\t\treturn {\n\t\t\t\tname: func.Name,\n\t\t\t\treturnType: func.ReturnType,\n\t\t\t\tentitySet: func.EntitySet,\n\t\t\t\tparameters: parameters,\n\t\t\t\tmethod: func.HttpM+
ethod as MetadataFunctionMethod,\n\t\t\t};\n\t\t});\n\t}\n\tasync readEntity(options: {\n\t\tentityName: string;\n\t\tfilters: Filter[];\n\t\tsorting: Sorter[];\n\t\theaders: Record<string, string>;\n\t\ttop: number;\n\t\tskip: number;\n\t}): Promise<obj+
ect> {\n\t\tconst binding = this.model.bindList(\n\t\t\t\"/\" + options.entityName,\n\t\t\tundefined,\n\t\t\t[],\n\t\t\t[],\n\t\t\t{}\n\t\t);\n\t\tconst contexts = await binding.requestContexts();\n\t\treturn contexts.map((context) => context.getObject()+
 as object);\n\t}\n\tgetModel(): ODataModel {\n\t\treturn this.model as unknown as ODataModel;\n\t}\n\tgetMetadataText(): string {\n\t\treturn this.metadataText;\n\t}\n\tgetMetadataXml(): XMLDocument {\n\t\treturn this.metadataXml;\n\t}\n\tasync initAsyn+
c() {\n\t\tthis.metadataText = await ODataHelper.getMetadataText(this.serviceUrl);\n\t\tthis.metadataXml = ODataHelper.parseMetadataXml(this.metadataText);\n\t}\n\n\texecuteFunction(options: {\n\t\tfunctionName: string,\n\t\tparameters: Record<string, st+
ring | number | boolean>,\n\t\tmethod: 'GET' | 'POST'\n\t}): Promise<unknown> {\n\t\tthrow new Error(\"Not implemented\");\n\t}\n\n\texecuteAction(options: {\n\t\tactionName: string,\n\t\tparameters: Record<string, string | number | boolean>,\n\t\tmethod+
: 'GET' | 'POST'\n\t}): Promise<unknown> {\n\t\tthrow new Error(\"Not implemented\");\n\t}\n}\n"],"mappings":"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","ignoreList":[]} 