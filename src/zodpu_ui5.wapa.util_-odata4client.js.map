{"version":3,"file":"OData4Client.js","names":["ODataHelper","_interopRequireDefault","__ODataHelper","OData4Client","constructor","serviceUrl","escapedServiceUrl","endsWith","this","model","ODataModelV4","synchronizationMode","earlyRequests","httpHeader+
s","attachDataReceived","event","parameters","getParameters","error","status","message","requestUrl","MessageBox","getActions","actions","actionNodes","Array","from","metadataXml","getElementsByTagName","map","node","Name","getAttribute","IsBound","Param+
eters","paramNode","Type","Nullable","action","push","name","isBound","param","type","nullable","destroy","createEntity","entityName","properties","binding","bindList","undefined","$$getKeepAliveContext","createdContext","create","created","deleteEntity"+
,"keys","keyPath","Object","entries","_ref","key","value","join","entityBinding","getKeepAliveContext","delete","getEntity","_ref2","bindContext","obj","requestObject","Error","getEntities","entities","entitySets","EntityType","entity","entityType","incl+
udes","split","pop","entityTypeNode","find","propertyNode","maxLength","getMaxLength","keyNode","propertyRefs","property","getFunctions","functionImports","ReturnType","EntitySet","HttpMethod","func","returnType","entitySet","method","readEntity","option+
s","contexts","requestContexts","context","getObject","getModel","getMetadataText","metadataText","getMetadataXml","initAsync","parseMetadataXml","executeFunction","executeAction"],"sources":["OData4Client.ts"],"sourcesContent":["import Filter from \"sap+
/ui/model/Filter\";\nimport IODataClient, { ODataAction } from \"./IODataClient\";\nimport ODataModel from \"sap/ui/model/odata/ODataModel\";\nimport ODataModelV4, {\n\tODataModel$DataReceivedEvent,\n} from \"sap/ui/model/odata/v4/ODataModel\";\nimport {+
\n\tMetadataAction,\n\tMetadataEntity,\n\tMetadataFunction,\n\tMetadataFunctionMethod,\n} from \"../Types\";\nimport ODataHelper from \"./ODataHelper\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport Sorter from \"sap/ui/model/Sorter\";\n\n/**\n *+
 @namespace de.kernich.odpu.util\n */\nexport default class OData4Client implements IODataClient {\n\tprivate model: ODataModelV4;\n\tprivate serviceUrl: string;\n\tprivate metadataText: string;\n\tprivate metadataXml: XMLDocument;\n\tconstructor(service+
Url: string) {\n\t\tlet escapedServiceUrl = serviceUrl;\n\t\tif (!escapedServiceUrl.endsWith(\"/\")) {\n\t\t\tescapedServiceUrl += \"/\";\n\t\t}\n\t\tthis.serviceUrl = escapedServiceUrl;\n\t\tthis.model = new ODataModelV4({\n\t\t\tserviceUrl: escapedServ+
iceUrl,\n\t\t\tsynchronizationMode: \"None\",\n\t\t\tearlyRequests: true,\n\t\t\thttpHeaders: {},\n\t\t});\n\n\t\tthis.model.attachDataReceived({}, (event: ODataModel$DataReceivedEvent) => {\n\t\t\tconst parameters = event.getParameters() as unknown as {+
\n\t\t\t\terror?: {\n\t\t\t\t\terror: {\n\t\t\t\t\t\tcode: string;\n\t\t\t\t\t\tmessage: string;\n\t\t\t\t\t};\n\t\t\t\t\tmessage: string;\n\t\t\t\t\tstatus: number;\n\t\t\t\t\trequestUrl: string;\n\t\t\t\t};\n\t\t\t\tdata?: object;\n\t\t\t};\n\t\t\tif (+
parameters.error?.status >= 400) {\n\t\t\t\tconst message =\n\t\t\t\t\t\"Requested failed: \" +\n\t\t\t\t\tparameters.error.requestUrl +\n\t\t\t\t\t\"\\n\\nMessage: \" +\n\t\t\t\t\tparameters.error.message;\n\t\t\t\tMessageBox.error(message);\n\t\t\t}\n\+
t\t});\n\t}\n\tgetActions(): MetadataAction[] {\n\t\tconst actions: MetadataAction[] = [];\n\n\t\tconst actionNodes = Array.from(\n\t\t\tthis.metadataXml.getElementsByTagName(\"Action\")\n\t\t).map((node) => ({\n\t\t\tName: node.getAttribute(\"Name\"),\n+
\t\t\tIsBound: node.getAttribute(\"IsBound\"),\n\t\t\tParameters: Array.from(node.getElementsByTagName(\"Parameter\")).map(\n\t\t\t\t(paramNode) => ({\n\t\t\t\t\tName: paramNode.getAttribute(\"Name\"),\n\t\t\t\t\tType: paramNode.getAttribute(\"Type\"),\n+
\t\t\t\t\tNullable: paramNode.getAttribute(\"Nullable\"),\n\t\t\t\t})\n\t\t\t),\n\t\t}));\n\n\t\tfor (const action of actionNodes) {\n\t\t\tactions.push({\n\t\t\t\tname: action.Name,\n\t\t\t\tisBound: action.IsBound === \"true\",\n\t\t\t\tparameters: act+
ion.Parameters.map((param) => ({\n\t\t\t\t\tname: param.Name,\n\t\t\t\t\ttype: param.Type,\n\t\t\t\t\tnullable: param.Nullable === \"true\",\n\t\t\t\t})),\n\t\t\t});\n\t\t}\n\n\t\treturn actions;\n\t}\n\tdestroy(): void {}\n\n\tasync createEntity(\n\t\te+
ntityName: string,\n\t\tproperties: Record<string, string | number | boolean>\n\t) {\n\t\tconst binding = this.model.bindList(`/${entityName}`, undefined, [], [], {\n\t\t\t$$getKeepAliveContext: true,\n\t\t});\n\n\t\tconst createdContext = binding.create+
(properties);\n\n\t\tawait createdContext.created();\n\t}\n\tdeleteEntity(\n\t\tentityName: string,\n\t\tkeys: Record<string, string | number | boolean>\n\t) {\n\t\tconst keyPath = Object.entries(keys)\n\t\t\t.map(([key, value]) => `${key}='${value}'`)\n+
\t\t\t.join(\",\");\n\t\tconst entityBinding = this.model.getKeepAliveContext(\n\t\t\t`/${entityName}(${keyPath})`\n\t\t);\n\n\t\treturn entityBinding.delete();\n\t}\n\tasync getEntity(\n\t\tentityName: string,\n\t\tkeys: Record<string, string | number |+
 boolean>\n\t): Promise<object> {\n\t\tconst keyPath = Object.entries(keys)\n\t\t\t.map(([key, value]) => `${key}='${value}'`)\n\t\t\t.join(\",\");\n\t\tconst binding = this.model.bindContext(`/${entityName}(${keyPath})`);\n\t\tconst obj = (await binding+
.requestObject()) as object;\n\t\tif (obj === undefined) {\n\t\t\tthrow new Error(\"Entity not found\");\n\t\t}\n\t\treturn obj;\n\t}\n\tgetEntities(): MetadataEntity[] {\n\t\tconst entities: MetadataEntity[] = [];\n\n\t\tconst entitySets = Array.from(\n+
\t\t\tthis.metadataXml.getElementsByTagName(\"EntitySet\")\n\t\t).map((node) => ({\n\t\t\tName: node.getAttribute(\"Name\"),\n\t\t\tEntityType: node.getAttribute(\"EntityType\"),\n\t\t}));\n\n\t\tfor (const entity of entitySets) {\n\t\t\tlet entityType =+
 entity.EntityType;\n\t\t\tif (entityType.includes(\".\")) {\n\t\t\t\tentityType = entityType.split(\".\").pop();\n\t\t\t}\n\t\t\tconst entityTypeNode = Array.from(\n\t\t\t\tthis.metadataXml.getElementsByTagName(\"EntityType\")\n\t\t\t).find((node) => {\+
n\t\t\t\treturn node.getAttribute(\"Name\") === entityType;\n\t\t\t});\n\t\t\tconst properties = Array.from(\n\t\t\t\tentityTypeNode.getElementsByTagName(\"Property\")\n\t\t\t).map((propertyNode) => ({\n\t\t\t\tname: propertyNode.getAttribute(\"Name\"),\+
n\t\t\t\ttype: propertyNode.getAttribute(\"Type\"),\n\t\t\t\tnullable: propertyNode.getAttribute(\"Nullable\"),\n\t\t\t\tmaxLength: ODataHelper.getMaxLength(\n\t\t\t\t\tpropertyNode.getAttribute(\"MaxLength\")\n\t\t\t\t),\n\t\t\t}));\n\t\t\tconst keyNode+
 = entityTypeNode.getElementsByTagName(\"Key\")[0];\n\n\t\t\tconst propertyRefs = Array.from(\n\t\t\t\tkeyNode.getElementsByTagName(\"PropertyRef\")\n\t\t\t).map((keyNode) => ({\n\t\t\t\tname: keyNode.getAttribute(\"Name\"),\n\t\t\t\ttype: properties.fin+
d(\n\t\t\t\t\t(property) => property.name === keyNode.getAttribute(\"Name\")\n\t\t\t\t).type,\n\t\t\t\tnullable: properties.find(\n\t\t\t\t\t(property) => property.name === keyNode.getAttribute(\"Name\")\n\t\t\t\t).nullable,\n\t\t\t\tmaxLength: propertie+
s.find(\n\t\t\t\t\t(property) => property.name === keyNode.getAttribute(\"Name\")\n\t\t\t\t).maxLength,\n\t\t\t}));\n\n\t\t\tentities.push({\n\t\t\t\tname: entity.Name,\n\t\t\t\tentityType: entityType,\n\t\t\t\tproperties: properties,\n\t\t\t\tkeys: prop+
ertyRefs,\n\t\t\t});\n\t\t}\n\t\treturn entities;\n\t}\n\tgetFunctions(): MetadataFunction[] {\n\t\tconst functionImports = Array.from(\n\t\t\tthis.metadataXml.getElementsByTagName(\"FunctionImport\")\n\t\t).map((node) => ({\n\t\t\tName: node.getAttribut+
e(\"Name\"),\n\t\t\tReturnType: node.getAttribute(\"ReturnType\"),\n\t\t\tEntitySet: node.getAttribute(\"EntitySet\"),\n\t\t\tHttpMethod: node.getAttribute(\"m:HttpMethod\"),\n\t\t}));\n\n\t\treturn functionImports.map((func) => {\n\t\t\tconst parameters+
 = Array.from(\n\t\t\t\tthis.metadataXml.getElementsByTagName(\"Parameter\")\n\t\t\t).map((paramNode) => ({\n\t\t\t\tname: paramNode.getAttribute(\"Name\"),\n\t\t\t\ttype: paramNode.getAttribute(\"Type\"),\n\t\t\t\tnullable: paramNode.getAttribute(\"Null+
able\"),\n\t\t\t\tmaxLength: ODataHelper.getMaxLength(\n\t\t\t\t\tparamNode.getAttribute(\"MaxLength\")\n\t\t\t\t),\n\t\t\t}));\n\n\t\t\treturn {\n\t\t\t\tname: func.Name,\n\t\t\t\treturnType: func.ReturnType,\n\t\t\t\tentitySet: func.EntitySet,\n\t\t\t\+
tparameters: parameters,\n\t\t\t\tmethod: func.HttpMethod as MetadataFunctionMethod,\n\t\t\t};\n\t\t});\n\t}\n\tasync readEntity(options: {\n\t\tentityName: string;\n\t\tfilters: Filter[];\n\t\tsorting: Sorter[];\n\t\theaders: Record<string, string>;\n\t+
\ttop: number;\n\t\tskip: number;\n\t}): Promise<object> {\n\t\tconst binding = this.model.bindList(\n\t\t\t\"/\" + options.entityName,\n\t\t\tundefined,\n\t\t\t[],\n\t\t\t[],\n\t\t\t{}\n\t\t);\n\t\tconst contexts = await binding.requestContexts();\n\t\t+
return contexts.map((context) => context.getObject() as object);\n\t}\n\tgetModel(): ODataModel {\n\t\treturn this.model as unknown as ODataModel;\n\t}\n\tgetMetadataText(): string {\n\t\treturn this.metadataText;\n\t}\n\tgetMetadataXml(): XMLDocument {\+
n\t\treturn this.metadataXml;\n\t}\n\tasync initAsync() {\n\t\tthis.metadataText = await ODataHelper.getMetadataText(this.serviceUrl);\n\t\tthis.metadataXml = ODataHelper.parseMetadataXml(this.metadataText);\n\t}\n\n\texecuteFunction(options: {\n\t\tfunc+
tionName: string,\n\t\tparameters: Record<string, string | number | boolean>,\n\t\tmethod: 'GET' | 'POST'\n\t}): Promise<unknown> {\n\t\tthrow new Error(\"Not implemented\");\n\t}\n\n\texecuteAction(options: {\n\t\tactionName: string,\n\t\tparameters: Re+
cord<string, string | number | boolean>,\n\t\tmethod: 'GET' | 'POST'\n\t}): Promise<unknown> {\n\t\tthrow new Error(\"Not implemented\");\n\t}\n}\n"],"mappings":"0MAYOA,EAAWC,EAAAC,GAOH,MAAMC,EAKpBC,YAAYC,GACX,IAAIC,EAAoBD,EACxB,IAAKC,EAAkBC,SAAS,KAAM,CA+
CrCD,GAAqB,GACtB,CACAE,KAAKH,WAAaC,EAClBE,KAAKC,MAAQ,IAAIC,EAAa,CAC7BL,WAAYC,EACZK,oBAAqB,OACrBC,cAAe,KACfC,YAAa,CAAC,IAGfL,KAAKC,MAAMK,mBAAmB,CAAC,EAAIC,IAClC,MAAMC,EAAaD,EAAME,gBAYzB,GAAID,EAAWE,OAAOC,QAAU,IAAK,CACpC,MAAMC,EACL,qBACAJ,EAAWE,MAAMG,WACjB+
,gBACAL,EAAWE,MAAME,QAClBE,EAAWJ,MAAME,EAClB,GAEF,CACAG,aACC,MAAMC,EAA4B,GAElC,MAAMC,EAAcC,MAAMC,KACzBnB,KAAKoB,YAAYC,qBAAqB,WACrCC,IAAKC,IAAI,CACVC,KAAMD,EAAKE,aAAa,QACxBC,QAASH,EAAKE,aAAa,WAC3BE,WAAYT,MAAMC,KAAKI,EAAKF,qBAAqB,cAAcC,IAC7DM,IAAS,CACTJ,KA+
AMI,EAAUH,aAAa,QAC7BI,KAAMD,EAAUH,aAAa,QAC7BK,SAAUF,EAAUH,aAAa,kBAKpC,IAAK,MAAMM,KAAUd,EAAa,CACjCD,EAAQgB,KAAK,CACZC,KAAMF,EAAOP,KACbU,QAASH,EAAOL,UAAY,OAC5BlB,WAAYuB,EAAOJ,WAAWL,IAAKa,IAAK,CACvCF,KAAME,EAAMX,KACZY,KAAMD,EAAMN,KACZQ,SAAUF,EAAML,WAAa,WAGh+
C,CAEA,OAAOd,CACR,CACAsB,UAAiB,CAEjB,kBAAMC,CACLC,EACAC,GAEA,MAAMC,EAAU1C,KAAKC,MAAM0C,SAAS,IAAIH,IAAcI,UAAW,GAAI,GAAI,CACxEC,sBAAuB,OAGxB,MAAMC,EAAiBJ,EAAQK,OAAON,SAEhCK,EAAeE,SACtB,CACAC,aACCT,EACAU,GAEA,MAAMC,EAAUC,OAAOC,QAAQH,GAC7B5B,IAAIgC,IAAA,IAAE+
C,EAAKC,GAAMF,EAAA,MAAK,GAAGC,MAAQC,IAAQ,GACzCC,KAAK,KACP,MAAMC,EAAgB1D,KAAKC,MAAM0D,oBAChC,IAAInB,KAAcW,MAGnB,OAAOO,EAAcE,QACtB,CACA,eAAMC,CACLrB,EACAU,GAEA,MAAMC,EAAUC,OAAOC,QAAQH,GAC7B5B,IAAIwC,IAAA,IAAEP,EAAKC,GAAMM,EAAA,MAAK,GAAGP,MAAQC,IAAQ,GACzCC,+
KAAK,KACP,MAAMf,EAAU1C,KAAKC,MAAM8D,YAAY,IAAIvB,KAAcW,MACzD,MAAMa,QAAatB,EAAQuB,gBAC3B,GAAID,IAAQpB,UAAW,CACtB,MAAM,IAAIsB,MAAM,mBACjB,CACA,OAAOF,CACR,CACAG,cACC,MAAMC,EAA6B,GAEnC,MAAMC,EAAanD,MAAMC,KACxBnB,KAAKoB,YAAYC,qBAAqB,cACrCC,IAAKC,IAAI,CACVC,KAA+
MD,EAAKE,aAAa,QACxB6C,WAAY/C,EAAKE,aAAa,iBAG/B,IAAK,MAAM8C,KAAUF,EAAY,CAChC,IAAIG,EAAaD,EAAOD,WACxB,GAAIE,EAAWC,SAAS,KAAM,CAC7BD,EAAaA,EAAWE,MAAM,KAAKC,KACpC,CACA,MAAMC,EAAiB1D,MAAMC,KAC5BnB,KAAKoB,YAAYC,qBAAqB,eACrCwD,KAAMtD,GACAA,EAAKE,aAAa,UAAY+C,GAEt+
C,MAAM/B,EAAavB,MAAMC,KACxByD,EAAevD,qBAAqB,aACnCC,IAAKwD,IAAY,CAClB7C,KAAM6C,EAAarD,aAAa,QAChCW,KAAM0C,EAAarD,aAAa,QAChCY,SAAUyC,EAAarD,aAAa,YACpCsD,UAAWvF,EAAYwF,aACtBF,EAAarD,aAAa,iBAG5B,MAAMwD,EAAUL,EAAevD,qBAAqB,OAAO,GAE3D,MAAM6D,EAAehE,MAAMC,KAC1B8+
D,EAAQ5D,qBAAqB,gBAC5BC,IAAK2D,IAAO,CACbhD,KAAMgD,EAAQxD,aAAa,QAC3BW,KAAMK,EAAWoC,KACfM,GAAaA,EAASlD,OAASgD,EAAQxD,aAAa,SACpDW,KACFC,SAAUI,EAAWoC,KACnBM,GAAaA,EAASlD,OAASgD,EAAQxD,aAAa,SACpDY,SACF0C,UAAWtC,EAAWoC,KACpBM,GAAaA,EAASlD,OAASgD,EAAQxD,aAAa,SA+
CpDsD,aAGHX,EAASpC,KAAK,CACbC,KAAMsC,EAAO/C,KACbgD,WAAYA,EACZ/B,WAAYA,EACZS,KAAMgC,GAER,CACA,OAAOd,CACR,CACAgB,eACC,MAAMC,EAAkBnE,MAAMC,KAC7BnB,KAAKoB,YAAYC,qBAAqB,mBACrCC,IAAKC,IAAI,CACVC,KAAMD,EAAKE,aAAa,QACxB6D,WAAY/D,EAAKE,aAAa,cAC9B8D,UAAWhE,EAAKE,a+
AAa,aAC7B+D,WAAYjE,EAAKE,aAAa,mBAG/B,OAAO4D,EAAgB/D,IAAKmE,IAC3B,MAAMjF,EAAaU,MAAMC,KACxBnB,KAAKoB,YAAYC,qBAAqB,cACrCC,IAAKM,IAAS,CACfK,KAAML,EAAUH,aAAa,QAC7BW,KAAMR,EAAUH,aAAa,QAC7BY,SAAUT,EAAUH,aAAa,YACjCsD,UAAWvF,EAAYwF,aACtBpD,EAAUH,aAAa,iBAIzB,MAAO,+
CACNQ,KAAMwD,EAAKjE,KACXkE,WAAYD,EAAKH,WACjBK,UAAWF,EAAKF,UAChB/E,WAAYA,EACZoF,OAAQH,EAAKD,WACb,EAEH,CACA,gBAAMK,CAAWC,GAQhB,MAAMpD,EAAU1C,KAAKC,MAAM0C,SAC1B,IAAMmD,EAAQtD,WACdI,UACA,GACA,GACA,CAAC,GAEF,MAAMmD,QAAiBrD,EAAQsD,kBAC/B,OAAOD,EAASzE,IAAK2E,GA+
AYA,EAAQC,YAC1C,CACAC,WACC,OAAOnG,KAAKC,KACb,CACAmG,kBACC,OAAOpG,KAAKqG,YACb,CACAC,iBACC,OAAOtG,KAAKoB,WACb,CACA,eAAMmF,GACLvG,KAAKqG,mBAAqB7G,EAAY4G,gBAAgBpG,KAAKH,YAC3DG,KAAKoB,YAAc5B,EAAYgH,iBAAiBxG,KAAKqG,aACtD,CAEAI,gBAAgBX,GAKf,MAAM,IAAI5B,MAAM,kBA+
CjB,CAEAwC,cAAcZ,GAKb,MAAM,IAAI5B,MAAM,kBACjB,EACA,OAAAvE,CAAA","ignoreList":[]}                                                                                                                                                                               