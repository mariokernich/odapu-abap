sap.ui.define(["../../util/DialogController", "sap/m/MessageToast", "sap/m/MessageBox", "sap/ui/model/Filter", "sap/ui/model/FilterOperator"], function (__DialogController, MessageToast, MessageBox, Filter, FilterOperator) {                               
  "use strict";                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
  function _interopRequireDefault(obj) {                                                                                                                                                                                                                       
    return obj && obj.__esModule && typeof obj.default !== "undefined" ? obj.default : obj;                                                                                                                                                                    
  }                                                                                                                                                                                                                                                            
  const DialogController = _interopRequireDefault(__DialogController);                                                                                                                                                                                         
  /**                                                                                                                                                                                                                                                          
   * @namespace de.kernich.odpu.controller.dialog                                                                                                                                                                                                              
   */                                                                                                                                                                                                                                                          
  const ProjectListDialogController = DialogController.extend("de.kernich.odpu.controller.dialog.ProjectListDialogController", {                                                                                                                               
    constructor: function constructor() {                                                                                                                                                                                                                      
      DialogController.prototype.constructor.apply(this, arguments);                                                                                                                                                                                           
      this.data = {                                                                                                                                                                                                                                            
        projects: [],                                                                                                                                                                                                                                          
        selectedProject: null                                                                                                                                                                                                                                  
      };                                                                                                                                                                                                                                                       
    },                                                                                                                                                                                                                                                         
    onSearch: function _onSearch(event) {                                                                                                                                                                                                                      
      const query = event.getParameter("newValue")?.toLowerCase() ?? "";                                                                                                                                                                                       
      const table = this.getElement("idProjectsTable");                                                                                                                                                                                                        
      const binding = table.getBinding("items");                                                                                                                                                                                                               
      if (binding) {                                                                                                                                                                                                                                           
        binding.filter(query ? new Filter("ProjectName", FilterOperator.Contains, query) : []);                                                                                                                                                                
        this.updateDialogTitle();                                                                                                                                                                                                                              
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    onLoad: function _onLoad() {                                                                                                                                                                                                                               
      const table = this.getElement("idProjectsTable");                                                                                                                                                                                                        
      const selectedItem = table.getSelectedItem();                                                                                                                                                                                                            
      if (!selectedItem) {                                                                                                                                                                                                                                     
        MessageToast.show("Please select a project");                                                                                                                                                                                                          
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
      const bindingContext = selectedItem.getBindingContext("dialog");                                                                                                                                                                                         
      if (!bindingContext) {                                                                                                                                                                                                                                   
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
      const project = bindingContext.getObject();                                                                                                                                                                                                              
      this.data.selectedProject = project;                                                                                                                                                                                                                     
      this.onConfirm();                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    onDelete: async function _onDelete(event) {                                                                                                                                                                                                                
      const source = event.getSource();                                                                                                                                                                                                                        
      const listItem = source.getParent()?.getParent();                                                                                                                                                                                                        
      const bindingContext = listItem.getBindingContext("dialog");                                                                                                                                                                                             
      if (!bindingContext) {                                                                                                                                                                                                                                   
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
      const project = bindingContext.getObject();                                                                                                                                                                                                              
      const confirmed = await this.dialogManager.showConfirmationDialog(`Are you sure you want to delete project "${project.ProjectName}"?`);                                                                                                                  
      if (confirmed) {                                                                                                                                                                                                                                         
        this.dialog.setBusy(true);                                                                                                                                                                                                                             
        try {                                                                                                                                                                                                                                                  
          await this.requests.deleteProject(project);                                                                                                                                                                                                          
          MessageToast.show("Project deleted successfully");                                                                                                                                                                                                   
          const index = this.data.projects.findIndex(p => p.ProjectName === project.ProjectName);                                                                                                                                                              
          if (index > -1) {                                                                                                                                                                                                                                    
            this.data.projects.splice(index, 1);                                                                                                                                                                                                               
            this.updateDialogTitle();                                                                                                                                                                                                                          
          }                                                                                                                                                                                                                                                    
        } catch (error) {                                                                                                                                                                                                                                      
          const errorMessage = error instanceof Error ? error.message : String(error);                                                                                                                                                                         
          MessageBox.error(`Error deleting project: ${errorMessage}`);                                                                                                                                                                                         
        } finally {                                                                                                                                                                                                                                            
          this.dialog.setBusy(false);                                                                                                                                                                                                                          
        }                                                                                                                                                                                                                                                      
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    updateDialogTitle: function _updateDialogTitle() {                                                                                                                                                                                                         
      const table = this.getElement("idProjectsTable");                                                                                                                                                                                                        
      const binding = table.getBinding("items");                                                                                                                                                                                                               
      const filteredLength = binding ? binding.getLength() : 0;                                                                                                                                                                                                
      this.dialog.setTitle(`Saved Projects (${filteredLength})`);                                                                                                                                                                                              
    }                                                                                                                                                                                                                                                          
  });                                                                                                                                                                                                                                                          
  return ProjectListDialogController;                                                                                                                                                                                                                          
});                                                                                                                                                                                                                                                            
//# sourceMappingURL=ProjectListDialogController-dbg.js.map                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               