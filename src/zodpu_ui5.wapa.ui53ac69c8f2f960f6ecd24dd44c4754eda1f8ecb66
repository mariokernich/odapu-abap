sap.ui.define(["../../util/DialogController", "sap/m/MessageToast", "sap/m/MessageBox", "sap/ui/model/Filter", "sap/ui/model/FilterOperator"], function (__DialogController, MessageToast, MessageBox, Filter, FilterOperator) {                               
  "use strict";                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
  function _interopRequireDefault(obj) {                                                                                                                                                                                                                       
    return obj && obj.__esModule && typeof obj.default !== "undefined" ? obj.default : obj;                                                                                                                                                                    
  }                                                                                                                                                                                                                                                            
  const DialogController = _interopRequireDefault(__DialogController);                                                                                                                                                                                         
  /**                                                                                                                                                                                                                                                          
   * @namespace de.kernich.odpu.controller.dialog                                                                                                                                                                                                              
   */                                                                                                                                                                                                                                                          
  const ProjectListDialogController = DialogController.extend("de.kernich.odpu.controller.dialog.ProjectListDialogController", {                                                                                                                               
    constructor: function constructor() {                                                                                                                                                                                                                      
      DialogController.prototype.constructor.apply(this, arguments);                                                                                                                                                                                           
      this.data = {                                                                                                                                                                                                                                            
        projects: [],                                                                                                                                                                                                                                          
        selectedProject: null                                                                                                                                                                                                                                  
      };                                                                                                                                                                                                                                                       
    },                                                                                                                                                                                                                                                         
    onSearch: function _onSearch(event) {                                                                                                                                                                                                                      
      const query = event.getParameter("newValue")?.toLowerCase() ?? "";                                                                                                                                                                                       
      const list = this.getElement("idProjectsList");                                                                                                                                                                                                          
      const binding = list.getBinding("items");                                                                                                                                                                                                                
      if (binding) {                                                                                                                                                                                                                                           
        binding.filter(query ? new Filter("ProjectName", FilterOperator.Contains, query) : []);                                                                                                                                                                
        this.updateDialogTitle();                                                                                                                                                                                                                              
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    onLoad: function _onLoad() {                                                                                                                                                                                                                               
      const list = this.getElement("idProjectsList");                                                                                                                                                                                                          
      const selectedItem = list.getSelectedItem();                                                                                                                                                                                                             
      if (!selectedItem) {                                                                                                                                                                                                                                     
        MessageToast.show(this.getText("msg.selectProject"));                                                                                                                                                                                                  
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
      const bindingContext = selectedItem.getBindingContext("dialog");                                                                                                                                                                                         
      if (!bindingContext) {                                                                                                                                                                                                                                   
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
      const project = bindingContext.getObject();                                                                                                                                                                                                              
      this.data.selectedProject = project;                                                                                                                                                                                                                     
      this.onConfirm();                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    refresh: async function _refresh() {                                                                                                                                                                                                                       
      this.dialog.setBusy(true);                                                                                                                                                                                                                               
      try {                                                                                                                                                                                                                                                    
        const projects = await this.requests.getProjects();                                                                                                                                                                                                    
        const model = this.dialog.getModel("dialog");                                                                                                                                                                                                          
        model.setProperty("/projects", projects);                                                                                                                                                                                                              
        model.refresh(true);                                                                                                                                                                                                                                   
      } finally {                                                                                                                                                                                                                                              
        this.dialog.setBusy(false);                                                                                                                                                                                                                            
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    onAfterOpen: function _onAfterOpen() {                                                                                                                                                                                                                     
      DialogController.prototype.onAfterOpen.call(this);                                                                                                                                                                                                       
      this.updateDialogTitle();                                                                                                                                                                                                                                
    },                                                                                                                                                                                                                                                         
    onDelete: async function _onDelete(event) {                                                                                                                                                                                                                
      const source = event.getSource();                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
      // Get project data from custom data                                                                                                                                                                                                                     
      const customData = source.getCustomData();                                                                                                                                                                                                               
      const projectData = customData.find(data => data.getKey() === "project");                                                                                                                                                                                
      if (!projectData) {                                                                                                                                                                                                                                      
        return;                                                                                                                                                                                                                                                
      }                                                                                                                                                                                                                                                        
      const project = projectData.getValue();                                                                                                                                                                                                                  
      const confirmed = await this.dialogManager.showConfirmationDialog(`Are you sure you want to delete project "${project.ProjectName}"?`);                                                                                                                  
      if (confirmed) {                                                                                                                                                                                                                                         
        this.dialog.setBusy(true);                                                                                                                                                                                                                             
        try {                                                                                                                                                                                                                                                  
          await this.requests.deleteProject(project);                                                                                                                                                                                                          
          MessageToast.show(this.getText("msg.projectDeleted"));                                                                                                                                                                                               
          await this.refresh();                                                                                                                                                                                                                                
          this.updateDialogTitle();                                                                                                                                                                                                                            
        } catch (error) {                                                                                                                                                                                                                                      
          const errorMessage = error instanceof Error ? error.message : String(error);                                                                                                                                                                         
          MessageBox.error(`Error deleting project: ${errorMessage}`);                                                                                                                                                                                         
        } finally {                                                                                                                                                                                                                                            
          this.dialog.setBusy(false);                                                                                                                                                                                                                          
        }                                                                                                                                                                                                                                                      
      }                                                                                                                                                                                                                                                        
    },                                                                                                                                                                                                                                                         
    updateDialogTitle: function _updateDialogTitle() {                                                                                                                                                                                                         
      const list = this.getElement("idProjectsList");                                                                                                                                                                                                          
      const binding = list.getBinding("items");                                                                                                                                                                                                                
      const filteredLength = binding ? binding.getLength() : 0;                                                                                                                                                                                                
      const title = this.getText("dlg.title.savedProjects");                                                                                                                                                                                                   
      this.dialog.setTitle(`${title} (${filteredLength})`);                                                                                                                                                                                                    
    }                                                                                                                                                                                                                                                          
  });                                                                                                                                                                                                                                                          
  return ProjectListDialogController;                                                                                                                                                                                                                          
});                                                                                                                                                                                                                                                            
//# sourceMappingURL=ProjectListDialogController-dbg.js.map                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               