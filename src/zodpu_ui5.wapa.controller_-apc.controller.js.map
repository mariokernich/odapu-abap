{"version":3,"file":"APC.controller.js","names":["BaseController","_interopRequireDefault","__BaseController","Constants","__Constants","Util","__Util","APC","extend","constructor","prototype","apply","this","arguments","local","folderTreeIcon","sap","ui+
","require","toUrl","fragmentId","apcModel","selectedApc","path","state","apcLog","entries","apcView","githubIcon","linkedinIcon","onInit","_onInit","BaseController.prototype.onInit.call","handleInit","getView","setModel","JSONModel","async","_handleInit+
","getGlobalModel","dataLoaded","setBusy","initModel","Device","support","websocket","MessageToast","show","component","getText","onChoosePushChannelButtonPress","_onChoosePushChannelButtonPress","handleAddApc","onDisconnectPushChannelButtonPress","_onDi+
sconnectPushChannelButtonPress","socket","close","onClearPushChannelButtonPress","_onClearPushChannelButtonPress","refreshApcLog","_handleAddApc","apcList","getOwnerComponent","requests","getPushChannels","dialogManager","pickApc","getModel","setProperty+
","Path","setTitle","ApplicationId","_initModel","model","metadataLoaded","setSizeLimit","SERVICE_QUERY_LIMIT","onConnectPushChannelButtonPress","_onConnectPushChannelButtonPress","Promise","resolve","reject","SapPcpWebSocket","attachMessage","event","pu+
sh","participant","data","getParameters","timestamp","Date","toISOString","attachOpen","attachClose","attachError","error","Error","JSON","stringify","focusFeedInput","showError","getById","_getById","id","globalId","control","Core","byId","_refreshApcLo+
g","refresh","refreshAggregation","onPostMessageButtonPress","_onPostMessageButtonPress","value","send","_focusFeedInput","focus","_setTitle","title"],"sources":["APC.controller.ts"],"sourcesContent":["import ODataModel from \"sap/ui/model/odata/v2/OData+
Model\";\nimport BaseController from \"./BaseController\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport MessageToast from \"sap/m/MessageToast\";\nimport Constants from \"../Constants\";\nimport Device from \"sap/ui/Device\";\nimport C+
ontrol from \"sap/ui/core/Control\";\nimport Core from \"sap/ui/core/Core\";\nimport SapPcpWebSocket, {\n\tSapPcpWebSocket$MessageEvent,\n} from \"sap/ui/core/ws/SapPcpWebSocket\";\nimport { FeedInput$PostEvent } from \"sap/m/FeedInput\";\nimport Util fr+
om \"../util/Util\";\nimport Table from \"sap/m/Table\";\n/**\n * @namespace de.kernich.odpu.controller\n */\nexport default class APC extends BaseController {\n\tprivate local = {\n\t\tfolderTreeIcon: sap.ui.require.toUrl(\n\t\t\t\"de/kernich/odpu/img/f+
older-tree-light.svg\"\n\t\t),\n\t};\n\n\tpublic fragmentId: string = \"\";\n\tpublic apcModel = {\n\t\tselectedApc: {\n\t\t\tpath: \"\",\n\t\t},\n\t\tstate: \"disconnected\" as \"connected\" | \"disconnected\",\n\t};\n\tpublic apcLog: {\n\t\tentries: {\+
n\t\t\tparticipant: string;\n\t\t\tdata: string;\n\t\t\ttimestamp: string;\n\t\t}[];\n\t} = {\n\t\tentries: [],\n\t};\n\tprivate socket: SapPcpWebSocket | undefined;\n\tprivate apcView = {\n\t\tgithubIcon: sap.ui.require.toUrl(\"de/kernich/odpu/img/githu+
b-brands.svg\"),\n\t\tlinkedinIcon: sap.ui.require.toUrl(\n\t\t\t\"de/kernich/odpu/img/linkedin-brands.svg\"\n\t\t),\n\t};\n\n\tonInit() {\n\t\tsuper.onInit();\n\t\tvoid this.handleInit();\n\n\t\tthis.getView()?.setModel(new JSONModel(this.apcModel, true+
), \"apcModel\");\n\t\tthis.getView()?.setModel(new JSONModel(this.apcLog, true), \"apcLog\");\n\t\tthis.getView()?.setModel(new JSONModel(this.apcView, true), \"apcView\");\n\t}\n\n\tprivate async handleInit() {\n\t\tawait this.getGlobalModel().dataLoad+
ed();\n\t\tthis.setBusy(true);\n\t\tawait this.initModel();\n\n\t\tthis.setBusy(false);\n\n\t\tif (!Device.support.websocket) {\n\t\t\tMessageToast.show(this.component.getText(\"msg.noSocketSupport\"));\n\t\t}\n\t}\n\n\tonChoosePushChannelButtonPress() {+
\n\t\tvoid this.handleAddApc();\n\t}\n\n\tonDisconnectPushChannelButtonPress() {\n\t\tthis.socket?.close();\n\t\tthis.apcModel.state = \"disconnected\";\n\t\tMessageToast.show(this.component.getText(\"msg.apcDisconnected\", [this.apcModel.selectedApc.pat+
h]));\n\t\tthis.apcModel.selectedApc = {\n\t\t\tpath: \"\",\n\t\t};\n\t}\n\n\tonClearPushChannelButtonPress() {\n\t\tthis.apcLog.entries = [];\n\t\tthis.refreshApcLog();\n\t}\n\n\tprivate async handleAddApc() {\n\t\tthis.setBusy(true);\n\t\ttry {\n\t\t\t+
const apcList = await this.getOwnerComponent().requests.getPushChannels();\n\t\t\tconst selectedApc = await this.component.dialogManager.pickApc(apcList);\n\t\t\t(this.getView()?.getModel(\"apcModel\") as JSONModel).setProperty(\"/selectedApc/path\", sel+
ectedApc.Path);\n\t\t\tthis.setTitle(selectedApc.ApplicationId);\n\t\t} finally {\n\t\t\tthis.setBusy(false);\n\t\t}\n\t}\n\n\tprivate async initModel() {\n\t\tconst model = this.getOwnerComponent().getModel() as ODataModel;\n\t\tawait model.metadataLoad+
ed(true);\n\t\tmodel.setSizeLimit(Constants.SERVICE_QUERY_LIMIT);\n\t}\n\n\tasync onConnectPushChannelButtonPress() {\n\t\tthis.setBusy(true);\n\t\ttry {\n\t\t\tawait new Promise<void>((resolve, reject) => {\n\t\t\t\tthis.socket = new SapPcpWebSocket(thi+
s.apcModel.selectedApc.path);\n\t\t\t\tthis.socket.attachMessage((event: SapPcpWebSocket$MessageEvent) => {\n\t\t\t\t\tthis.apcLog.entries.push({\n\t\t\t\t\t\tparticipant: \"Server\",\n\t\t\t\t\t\tdata: event.getParameters().data,\n\t\t\t\t\t\ttimestamp:+
 new Date().toISOString(),\n\t\t\t\t\t});\n\t\t\t\t\tthis.refreshApcLog();\n\t\t\t\t});\n\t\t\t\tthis.socket.attachOpen(() => {\n\t\t\t\t\tthis.apcModel.state = \"connected\";\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t\tthis.socket.attachClose(() => {\n\+
t\t\t\t\tthis.apcModel.state = \"disconnected\";\n\t\t\t\t});\n\t\t\t\tthis.socket.attachError((error: Error) => {\n\t\t\t\t\treject(new Error(\"failed to connect: \" + JSON.stringify(error)));\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.focusFeedInput();\n\t\t\+
tMessageToast.show(this.component.getText(\"msg.apcConnected\", [this.apcModel.selectedApc.path]));\n\t\t} catch (error) {\n\t\t\tUtil.showError(error);\n\t\t} finally {\n\t\t\tthis.setBusy(false);\n\t\t}\n\t}\n\n\tprivate getById(id: string): Control | +
undefined {\n\t\tconst fragmentId = this.fragmentId;\n\t\tconst globalId = `${fragmentId}--${id}`;\n\n\t\tconst control = Core.byId(globalId);\n\t\treturn control as Control;\n\t}\n\n\tpublic refreshApcLog() {\n\t\tthis.getView()?.getModel(\"apcLog\")?.r+
efresh();\n\t\t(this.getById(\"idLogTable\") as Table).refreshAggregation(\"items\");\n\t}\n\n\tpublic onPostMessageButtonPress(event: FeedInput$PostEvent) {\n\t\tthis.apcLog.entries.push({\n\t\t\tparticipant: \"Client\",\n\t\t\tdata: event.getParameters+
().value,\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t});\n\t\tthis.socket?.send(event.getParameters().value);\n\t\tthis.refreshApcLog();\n\t\tthis.focusFeedInput();\n\t}\n\n\tpublic focusFeedInput() {\n\t\tthis.getById(\"idFeedInput\")?.focus();\n\+
t}\n\n\tpublic setTitle(title: string) {\n\t\tthrow new Error(\"Not implemented: \" + title);\n\t}\n}\n"],"mappings":"sTACOA,EAAcC,EAAAC,GAAA,MAGdC,EAASF,EAAAG,GAAA,MAQTC,EAAIJ,EAAAK,GAEX,MAGqBC,EAAYP,EAAcQ,OAAA,kCAAAC,YAAA,SAAAA,IAAAT,EAAAU,UAAAD,YAAAE,+
MAAAC,KAAAC,WAAAD,KACtCE,MAAQ,CACfC,eAAgBC,IAAIC,GAAGC,QAAQC,MAC9B,8CAEDP,KAEMQ,WAAqB,GAAER,KACvBS,SAAW,CACjBC,YAAa,CACZC,KAAM,IAEPC,MAAO,gBACPZ,KACMa,OAMH,CACHC,QAAS,IACTd,KAEOe,QAAU,CACjBC,WAAYZ,IAAIC,GAAGC,QAAQC,MAAM,yCACjCU,aAAcb,IAAIC,GAAGC,QAAQC,MA+
C5B,2CAED,EAEDW,OAAM,SAAAC,IACLC,wBAAApB,WACKA,KAAKqB,aAEVrB,KAAKsB,WAAWC,SAAS,IAAIC,EAAUxB,KAAKS,SAAU,MAAO,YAC7DT,KAAKsB,WAAWC,SAAS,IAAIC,EAAUxB,KAAKa,OAAQ,MAAO,UAC3Db,KAAKsB,WAAWC,SAAS,IAAIC,EAAUxB,KAAKe,QAAS,MAAO,UAC7D,EAEcM,WAAUI,eAAAC,UACjB1B,KAAK2B+
,iBAAiBC,aAC5B5B,KAAK6B,QAAQ,YACP7B,KAAK8B,YAEX9B,KAAK6B,QAAQ,OAEb,IAAKE,EAAOC,QAAQC,UAAW,CAC9BC,EAAaC,KAAKnC,KAAKoC,UAAUC,QAAQ,uBAC1C,CACD,EAEAC,+BAA8B,SAAAC,SACxBvC,KAAKwC,cACX,EAEAC,mCAAkC,SAAAC,IACjC1C,KAAK2C,QAAQC,QACb5C,KAAKS,SAASG,MAAQ,eACtBsB,EAA+
aC,KAAKnC,KAAKoC,UAAUC,QAAQ,sBAAuB,CAACrC,KAAKS,SAASC,YAAYC,QAC3FX,KAAKS,SAASC,YAAc,CAC3BC,KAAM,GAER,EAEAkC,8BAA6B,SAAAC,IAC5B9C,KAAKa,OAAOC,QAAU,GACtBd,KAAK+C,eACN,EAEcP,aAAYf,eAAAuB,IACzBhD,KAAK6B,QAAQ,MACb,IACC,MAAMoB,QAAgBjD,KAAKkD,oBAAoBC,SAASC,kBAC+
xD,MAAM1C,QAAoBV,KAAKoC,UAAUiB,cAAcC,QAAQL,IAC9DjD,KAAKsB,WAAWiC,SAAS,aAA0BC,YAAY,oBAAqB9C,EAAY+C,MACjGzD,KAAK0D,SAAShD,EAAYiD,cAC3B,CAAC,QACA3D,KAAK6B,QAAQ,MACd,CACD,EAEcC,UAASL,eAAAmC,IACtB,MAAMC,EAAQ7D,KAAKkD,oBAAoBK,iBACjCM,EAAMC,eAAe,MAC3BD,EAAME,aA+
AaxE,EAAUyE,oBAC9B,EAEMC,gCAA+BxC,eAAAyC,IACpClE,KAAK6B,QAAQ,MACb,UACO,IAAIsC,QAAc,CAACC,EAASC,KACjCrE,KAAK2C,OAAS,IAAI2B,EAAgBtE,KAAKS,SAASC,YAAYC,MAC5DX,KAAK2C,OAAO4B,cAAeC,IAC1BxE,KAAKa,OAAOC,QAAQ2D,KAAK,CACxBC,YAAa,SACbC,KAAMH,EAAMI,gBAAgBD,KAC5BE,WA+
AW,IAAIC,MAAOC,gBAEvB/E,KAAK+C,kBAEN/C,KAAK2C,OAAOqC,WAAW,KACtBhF,KAAKS,SAASG,MAAQ,YACtBwD,MAEDpE,KAAK2C,OAAOsC,YAAY,KACvBjF,KAAKS,SAASG,MAAQ,iBAEvBZ,KAAK2C,OAAOuC,YAAaC,IACxBd,EAAO,IAAIe,MAAM,sBAAwBC,KAAKC,UAAUH,SAG1DnF,KAAKuF,iBACLrD,EAAaC,KAAKnC,KAAKo+
C,UAAUC,QAAQ,mBAAoB,CAACrC,KAAKS,SAASC,YAAYC,OACzF,CAAE,MAAOwE,GACR1F,EAAK+F,UAAUL,EAChB,CAAC,QACAnF,KAAK6B,QAAQ,MACd,CACD,EAEQ4D,QAAO,SAAAC,EAACC,GACf,MAAMnF,EAAaR,KAAKQ,WACxB,MAAMoF,EAAW,GAAGpF,MAAemF,IAEnC,MAAME,EAAUC,EAAKC,KAAKH,GAC1B,OAAOC,CACR,EAEO+
9C,cAAa,SAAAiD,IACnBhG,KAAKsB,WAAWiC,SAAS,WAAW0C,UACnCjG,KAAKyF,QAAQ,cAAwBS,mBAAmB,QAC1D,EAEOC,yBAAwB,SAAAC,EAAC5B,GAC/BxE,KAAKa,OAAOC,QAAQ2D,KAAK,CACxBC,YAAa,SACbC,KAAMH,EAAMI,gBAAgByB,MAC5BxB,WAAW,IAAIC,MAAOC,gBAEvB/E,KAAK2C,QAAQ2D,KAAK9B,EAAMI,gBAAgBy+
B,OACxCrG,KAAK+C,gBACL/C,KAAKuF,gBACN,EAEOA,eAAc,SAAAgB,IACpBvG,KAAKyF,QAAQ,gBAAgBe,OAC9B,EAEO9C,SAAQ,SAAA+C,EAACC,GACf,MAAM,IAAItB,MAAM,oBAAsBsB,EACvC,IAAC,OAvJmB/G,CAAG","ignoreList":[]}                                                                   