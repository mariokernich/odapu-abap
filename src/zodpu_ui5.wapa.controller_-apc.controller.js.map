{"version":3,"file":"APC.controller.js","names":["BaseController","_interopRequireDefault","__BaseController","Constants","__Constants","Util","__Util","APC","extend","constructor","prototype","apply","this","arguments","local","folderTreeIcon","sap","ui+
","require","toUrl","fragmentId","apcModel","selectedApc","path","state","apcLog","entries","apcView","githubIcon","linkedinIcon","onInit","_onInit","BaseController.prototype.onInit.call","handleInit","getView","setModel","JSONModel","async","_handleInit+
","getGlobalModel","dataLoaded","setBusy","initModel","Device","support","websocket","MessageToast","show","onChoosePushChannelButtonPress","_onChoosePushChannelButtonPress","handleAddApc","onDisconnectPushChannelButtonPress","_onDisconnectPushChannelBut+
tonPress","socket","close","onClearPushChannelButtonPress","_onClearPushChannelButtonPress","refreshApcLog","_handleAddApc","apcList","getApc","component","dialogManager","pickApc","setTitle","ApplicationId","_initModel","model","getOwnerComponent","getM+
odel","metadataLoaded","setSizeLimit","SERVICE_QUERY_LIMIT","onConnectPushChannelButtonPress","_onConnectPushChannelButtonPress","Promise","resolve","reject","SapPcpWebSocket","attachMessage","event","push","participant","data","getParameters","timestamp+
","Date","toISOString","attachOpen","attachClose","attachError","error","Error","JSON","stringify","focusFeedInput","showError","_getApc","read","success","results","urlParameters","$top","toString","getById","_getById","id","globalId","control","Core","+
byId","_refreshApcLog","refresh","refreshAggregation","onPostMessageButtonPress","_onPostMessageButtonPress","value","send","_focusFeedInput","focus","_setTitle","title"],"sources":["APC.controller.ts"],"sourcesContent":["import ODataModel from \"sap/ui/+
model/odata/v2/ODataModel\";\nimport BaseController from \"./BaseController\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport MessageToast from \"sap/m/MessageToast\";\nimport { ApcEntity } from \"../Types\";\nimport Constants from \"../+
Constants\";\nimport Device from \"sap/ui/Device\";\nimport Control from \"sap/ui/core/Control\";\nimport Core from \"sap/ui/core/Core\";\nimport SapPcpWebSocket, {\n\tSapPcpWebSocket$MessageEvent,\n} from \"sap/ui/core/ws/SapPcpWebSocket\";\nimport { Fe+
edInput$PostEvent } from \"sap/m/FeedInput\";\nimport Util from \"../util/Util\";\nimport Table from \"sap/m/Table\";\n/**\n * @namespace de.kernich.odpu.controller\n */\nexport default class APC extends BaseController {\n\tprivate local = {\n\t\tfolderT+
reeIcon: sap.ui.require.toUrl(\n\t\t\t\"de/kernich/odpu/img/folder-tree-light.svg\"\n\t\t),\n\t};\n\n\tpublic fragmentId: string = \"\";\n\tpublic apcModel = {\n\t\tselectedApc: {\n\t\t\tpath: \"\",\n\t\t},\n\t\tstate: \"disconnected\" as \"connected\" |+
 \"disconnected\",\n\t};\n\tpublic apcLog: {\n\t\tentries: {\n\t\t\tparticipant: string;\n\t\t\tdata: string;\n\t\t\ttimestamp: string;\n\t\t}[];\n\t} = {\n\t\tentries: [],\n\t};\n\tprivate socket: SapPcpWebSocket | undefined;\n\tprivate apcView = {\n\t\+
tgithubIcon: sap.ui.require.toUrl(\"de/kernich/odpu/img/github-brands.svg\"),\n\t\tlinkedinIcon: sap.ui.require.toUrl(\n\t\t\t\"de/kernich/odpu/img/linkedin-brands.svg\"\n\t\t),\n\t};\n\n\tonInit() {\n\t\tsuper.onInit();\n\t\tvoid this.handleInit();\n\n\+
t\tthis.getView().setModel(new JSONModel(this.apcModel, true), \"apcModel\");\n\t\tthis.getView().setModel(new JSONModel(this.apcLog, true), \"apcLog\");\n\t\tthis.getView().setModel(new JSONModel(this.apcView, true), \"apcView\");\n\t}\n\n\tprivate asyn+
c handleInit() {\n\t\tawait this.getGlobalModel().dataLoaded();\n\t\tthis.setBusy(true);\n\t\tawait this.initModel();\n\n\t\tthis.setBusy(false);\n\n\t\tif (!Device.support.websocket) {\n\t\t\tMessageToast.show(\"Note: WebSocket not supported\");\n\t\t}\+
n\t}\n\n\tonChoosePushChannelButtonPress() {\n\t\tvoid this.handleAddApc();\n\t}\n\n\tonDisconnectPushChannelButtonPress() {\n\t\tthis.socket?.close();\n\t\tthis.apcModel.state = \"disconnected\";\n\t\tMessageToast.show(\"Disconnected from \" + this.apcM+
odel.selectedApc.path);\n\t\tthis.apcModel.selectedApc = {\n\t\t\tpath: \"\",\n\t\t};\n\t}\n\n\tonClearPushChannelButtonPress() {\n\t\tthis.apcLog.entries = [];\n\t\tthis.refreshApcLog();\n\t}\n\n\tprivate async handleAddApc() {\n\t\tthis.setBusy(true);\+
n\t\ttry {\n\t\t\tconst apcList = await this.getApc();\n\t\t\tconst selectedApc = await this.component.dialogManager.pickApc(apcList);\n\t\t\tthis.apcModel.selectedApc = selectedApc;\n\t\t\tthis.setTitle(selectedApc.ApplicationId);\n\t\t} finally {\n\t\t+
\tthis.setBusy(false);\n\t\t}\n\t}\n\n\tprivate async initModel() {\n\t\tconst model = this.getOwnerComponent().getModel() as ODataModel;\n\t\tawait model.metadataLoaded(true);\n\t\tmodel.setSizeLimit(Constants.SERVICE_QUERY_LIMIT);\n\t}\n\n\tasync onCon+
nectPushChannelButtonPress() {\n\t\tthis.setBusy(true);\n\t\ttry {\n\t\t\tawait new Promise<void>((resolve, reject) => {\n\t\t\t\tthis.socket = new SapPcpWebSocket(this.apcModel.selectedApc.path);\n\t\t\t\tthis.socket.attachMessage((event: SapPcpWebSocke+
t$MessageEvent) => {\n\t\t\t\t\tthis.apcLog.entries.push({\n\t\t\t\t\t\tparticipant: \"Server\",\n\t\t\t\t\t\tdata: event.getParameters().data,\n\t\t\t\t\t\ttimestamp: new Date().toISOString(),\n\t\t\t\t\t});\n\t\t\t\t\tthis.refreshApcLog();\n\t\t\t\t});+
\n\t\t\t\tthis.socket.attachOpen(() => {\n\t\t\t\t\tthis.apcModel.state = \"connected\";\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t\tthis.socket.attachClose(() => {\n\t\t\t\t\tthis.apcModel.state = \"disconnected\";\n\t\t\t\t});\n\t\t\t\tthis.socket.atta+
chError((error: Error) => {\n\t\t\t\t\treject(new Error(\"failed to connect: \" + JSON.stringify(error)));\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.focusFeedInput();\n\t\t\tMessageToast.show(\"Connected to \" + this.apcModel.selectedApc.path);\n\t\t} catch (e+
rror) {\n\t\t\tUtil.showError(error);\n\t\t} finally {\n\t\t\tthis.setBusy(false);\n\t\t}\n\t}\n\n\tprivate async getApc(): Promise<ApcEntity[]> {\n\t\tconst model = this.getOwnerComponent().getModel() as ODataModel;\n\t\treturn new Promise((resolve, rej+
ect) => {\n\t\t\tmodel.read(\"/apcSet\", {\n\t\t\t\tsuccess: (data: { results: ApcEntity[] }) => {\n\t\t\t\t\tresolve(data.results);\n\t\t\t\t},\n\t\t\t\terror: reject,\n\t\t\t\turlParameters: {\n\t\t\t\t\t$top: Constants.SERVICE_QUERY_LIMIT.toString(),\+
n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate getById(id: string): Control | undefined {\n\t\tconst fragmentId = this.fragmentId;\n\t\tconst globalId = `${fragmentId}--${id}`;\n\n\t\tconst control = Core.byId(globalId);\n\t\treturn control as Control+
;\n\t}\n\n\tpublic refreshApcLog() {\n\t\tthis.getView().getModel(\"apcLog\").refresh();\n\t\t(this.getById(\"idLogTable\") as Table).refreshAggregation(\"items\");\n\t}\n\n\tpublic onPostMessageButtonPress(event: FeedInput$PostEvent) {\n\t\tthis.apcLog.+
entries.push({\n\t\t\tparticipant: \"Client\",\n\t\t\tdata: event.getParameters().value,\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t});\n\t\tthis.socket?.send(event.getParameters().value);\n\t\tthis.refreshApcLog();\n\t\tthis.focusFeedInput();\n\t}+
\n\n\tpublic focusFeedInput() {\n\t\tthis.getById(\"idFeedInput\")?.focus();\n\t}\n\n\tpublic setTitle(title: string) {\n\t\tthrow new Error(\"Not implemented: \" + title);\n\t}\n}\n"],"mappings":"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","ignoreList":[]}                                                                                                                                                         