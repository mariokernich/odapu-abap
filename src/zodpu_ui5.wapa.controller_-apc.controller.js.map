{"version":3,"file":"APC.controller.js","names":["BaseController","_interopRequireDefault","__BaseController","Constants","__Constants","Util","__Util","APC","extend","constructor","prototype","apply","this","arguments","local","folderTreeIcon","sap","ui+
","require","toUrl","fragmentId","apcModel","selectedApc","path","state","apcLog","entries","apcView","githubIcon","linkedinIcon","onInit","_onInit","BaseController.prototype.onInit.call","handleInit","getView","setModel","JSONModel","async","_handleInit+
","getGlobalModel","dataLoaded","setBusy","initModel","Device","support","websocket","MessageToast","show","onChoosePushChannelButtonPress","_onChoosePushChannelButtonPress","handleAddApc","onDisconnectPushChannelButtonPress","_onDisconnectPushChannelBut+
tonPress","socket","close","onClearPushChannelButtonPress","_onClearPushChannelButtonPress","refreshApcLog","_handleAddApc","apcList","getOwnerComponent","requests","getPushChannels","component","dialogManager","pickApc","getModel","setProperty","Path","+
setTitle","ApplicationId","_initModel","model","metadataLoaded","setSizeLimit","SERVICE_QUERY_LIMIT","onConnectPushChannelButtonPress","_onConnectPushChannelButtonPress","Promise","resolve","reject","SapPcpWebSocket","attachMessage","event","push","parti+
cipant","data","getParameters","timestamp","Date","toISOString","attachOpen","attachClose","attachError","error","Error","JSON","stringify","focusFeedInput","showError","getById","_getById","id","globalId","control","Core","byId","_refreshApcLog","refres+
h","refreshAggregation","onPostMessageButtonPress","_onPostMessageButtonPress","value","send","_focusFeedInput","focus","_setTitle","title"],"sources":["APC.controller.ts"],"sourcesContent":["import ODataModel from \"sap/ui/model/odata/v2/ODataModel\";\n+
import BaseController from \"./BaseController\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport MessageToast from \"sap/m/MessageToast\";\nimport { PushChannelEntity } from \"../Types\";\nimport Constants from \"../Constants\";\nimport D+
evice from \"sap/ui/Device\";\nimport Control from \"sap/ui/core/Control\";\nimport Core from \"sap/ui/core/Core\";\nimport SapPcpWebSocket, {\n\tSapPcpWebSocket$MessageEvent,\n} from \"sap/ui/core/ws/SapPcpWebSocket\";\nimport { FeedInput$PostEvent } fr+
om \"sap/m/FeedInput\";\nimport Util from \"../util/Util\";\nimport Table from \"sap/m/Table\";\n/**\n * @namespace de.kernich.odpu.controller\n */\nexport default class APC extends BaseController {\n\tprivate local = {\n\t\tfolderTreeIcon: sap.ui.requir+
e.toUrl(\n\t\t\t\"de/kernich/odpu/img/folder-tree-light.svg\"\n\t\t),\n\t};\n\n\tpublic fragmentId: string = \"\";\n\tpublic apcModel = {\n\t\tselectedApc: {\n\t\t\tpath: \"\",\n\t\t},\n\t\tstate: \"disconnected\" as \"connected\" | \"disconnected\",\n\t+
};\n\tpublic apcLog: {\n\t\tentries: {\n\t\t\tparticipant: string;\n\t\t\tdata: string;\n\t\t\ttimestamp: string;\n\t\t}[];\n\t} = {\n\t\tentries: [],\n\t};\n\tprivate socket: SapPcpWebSocket | undefined;\n\tprivate apcView = {\n\t\tgithubIcon: sap.ui.re+
quire.toUrl(\"de/kernich/odpu/img/github-brands.svg\"),\n\t\tlinkedinIcon: sap.ui.require.toUrl(\n\t\t\t\"de/kernich/odpu/img/linkedin-brands.svg\"\n\t\t),\n\t};\n\n\tonInit() {\n\t\tsuper.onInit();\n\t\tvoid this.handleInit();\n\n\t\tthis.getView().setM+
odel(new JSONModel(this.apcModel, true), \"apcModel\");\n\t\tthis.getView().setModel(new JSONModel(this.apcLog, true), \"apcLog\");\n\t\tthis.getView().setModel(new JSONModel(this.apcView, true), \"apcView\");\n\t}\n\n\tprivate async handleInit() {\n\t\t+
await this.getGlobalModel().dataLoaded();\n\t\tthis.setBusy(true);\n\t\tawait this.initModel();\n\n\t\tthis.setBusy(false);\n\n\t\tif (!Device.support.websocket) {\n\t\t\tMessageToast.show(\"Note: WebSocket not supported\");\n\t\t}\n\t}\n\n\tonChoosePush+
ChannelButtonPress() {\n\t\tvoid this.handleAddApc();\n\t}\n\n\tonDisconnectPushChannelButtonPress() {\n\t\tthis.socket?.close();\n\t\tthis.apcModel.state = \"disconnected\";\n\t\tMessageToast.show(\"Disconnected from \" + this.apcModel.selectedApc.path)+
;\n\t\tthis.apcModel.selectedApc = {\n\t\t\tpath: \"\",\n\t\t};\n\t}\n\n\tonClearPushChannelButtonPress() {\n\t\tthis.apcLog.entries = [];\n\t\tthis.refreshApcLog();\n\t}\n\n\tprivate async handleAddApc() {\n\t\tthis.setBusy(true);\n\t\ttry {\n\t\t\tcons+
t apcList = await this.getOwnerComponent().requests.getPushChannels();\n\t\t\tconst selectedApc = await this.component.dialogManager.pickApc(apcList);\n\t\t\t(this.getView()?.getModel(\"apcModel\") as JSONModel).setProperty(\"/selectedApc/path\", selecte+
dApc.Path);\n\t\t\tthis.setTitle(selectedApc.ApplicationId);\n\t\t} finally {\n\t\t\tthis.setBusy(false);\n\t\t}\n\t}\n\n\tprivate async initModel() {\n\t\tconst model = this.getOwnerComponent().getModel() as ODataModel;\n\t\tawait model.metadataLoaded(t+
rue);\n\t\tmodel.setSizeLimit(Constants.SERVICE_QUERY_LIMIT);\n\t}\n\n\tasync onConnectPushChannelButtonPress() {\n\t\tthis.setBusy(true);\n\t\ttry {\n\t\t\tawait new Promise<void>((resolve, reject) => {\n\t\t\t\tthis.socket = new SapPcpWebSocket(this.ap+
cModel.selectedApc.path);\n\t\t\t\tthis.socket.attachMessage((event: SapPcpWebSocket$MessageEvent) => {\n\t\t\t\t\tthis.apcLog.entries.push({\n\t\t\t\t\t\tparticipant: \"Server\",\n\t\t\t\t\t\tdata: event.getParameters().data,\n\t\t\t\t\t\ttimestamp: new+
 Date().toISOString(),\n\t\t\t\t\t});\n\t\t\t\t\tthis.refreshApcLog();\n\t\t\t\t});\n\t\t\t\tthis.socket.attachOpen(() => {\n\t\t\t\t\tthis.apcModel.state = \"connected\";\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t\tthis.socket.attachClose(() => {\n\t\t\+
t\t\tthis.apcModel.state = \"disconnected\";\n\t\t\t\t});\n\t\t\t\tthis.socket.attachError((error: Error) => {\n\t\t\t\t\treject(new Error(\"failed to connect: \" + JSON.stringify(error)));\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.focusFeedInput();\n\t\t\tMes+
sageToast.show(\"Connected to \" + this.apcModel.selectedApc.path);\n\t\t} catch (error) {\n\t\t\tUtil.showError(error);\n\t\t} finally {\n\t\t\tthis.setBusy(false);\n\t\t}\n\t}\n\n\tprivate getById(id: string): Control | undefined {\n\t\tconst fragmentI+
d = this.fragmentId;\n\t\tconst globalId = `${fragmentId}--${id}`;\n\n\t\tconst control = Core.byId(globalId);\n\t\treturn control as Control;\n\t}\n\n\tpublic refreshApcLog() {\n\t\tthis.getView().getModel(\"apcLog\").refresh();\n\t\t(this.getById(\"idL+
ogTable\") as Table).refreshAggregation(\"items\");\n\t}\n\n\tpublic onPostMessageButtonPress(event: FeedInput$PostEvent) {\n\t\tthis.apcLog.entries.push({\n\t\t\tparticipant: \"Client\",\n\t\t\tdata: event.getParameters().value,\n\t\t\ttimestamp: new Da+
te().toISOString(),\n\t\t});\n\t\tthis.socket?.send(event.getParameters().value);\n\t\tthis.refreshApcLog();\n\t\tthis.focusFeedInput();\n\t}\n\n\tpublic focusFeedInput() {\n\t\tthis.getById(\"idFeedInput\")?.focus();\n\t}\n\n\tpublic setTitle(title: str+
ing) {\n\t\tthrow new Error(\"Not implemented: \" + title);\n\t}\n}\n"],"mappings":"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","ignoreList":[]}                                                                                                                                                                            