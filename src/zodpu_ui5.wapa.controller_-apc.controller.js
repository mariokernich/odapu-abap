sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","../Constants","sap/ui/Device","sap/ui/core/Core","sap/ui/core/ws/SapPcpWebSocket","../util/Util"],function(t,e,s,n,o,i,a,c){"use strict";function r(t){return t&&t.__esM+
odule&&typeof t.default!=="undefined"?t.default:t}const h=r(t);const d=r(n);const p=r(c);const u=h.extend("de.kernich.odpu.controller.APC",{constructor:function t(){h.prototype.constructor.apply(this,arguments);this.local={folderTreeIcon:sap.ui.require.t+
oUrl("de/kernich/odpu/img/folder-tree-light.svg")};this.fragmentId="";this.apcModel={selectedApc:{path:""},state:"disconnected"};this.apcLog={entries:[]};this.apcView={githubIcon:sap.ui.require.toUrl("de/kernich/odpu/img/github-brands.svg"),linkedinIcon:+
sap.ui.require.toUrl("de/kernich/odpu/img/linkedin-brands.svg")}},onInit:function t(){h.prototype.onInit.call(this);void this.handleInit();this.getView()?.setModel(new e(this.apcModel,true),"apcModel");this.getView()?.setModel(new e(this.apcLog,true),"ap+
cLog");this.getView()?.setModel(new e(this.apcView,true),"apcView")},handleInit:async function t(){await this.getGlobalModel().dataLoaded();this.setBusy(true);await this.initModel();this.setBusy(false);if(!o.support.websocket){s.show(this.component.getTe+
xt("msg.noSocketSupport"))}},onChoosePushChannelButtonPress:function t(){void this.handleAddApc()},onDisconnectPushChannelButtonPress:function t(){this.socket?.close();this.apcModel.state="disconnected";s.show(this.component.getText("msg.apcDisconnected"+
,[this.apcModel.selectedApc.path]));this.apcModel.selectedApc={path:""}},onClearPushChannelButtonPress:function t(){this.apcLog.entries=[];this.refreshApcLog()},handleAddApc:async function t(){this.setBusy(true);try{const t=await this.getOwnerComponent()+
.requests.getPushChannels();const e=await this.component.dialogManager.pickApc(t);(this.getView()?.getModel("apcModel")).setProperty("/selectedApc/path",e.Path);this.setTitle(e.ApplicationId)}finally{this.setBusy(false)}},initModel:async function t(){con+
st e=this.getOwnerComponent().getModel();await e.metadataLoaded(true);e.setSizeLimit(d.SERVICE_QUERY_LIMIT)},onConnectPushChannelButtonPress:async function t(){this.setBusy(true);try{await new Promise((t,e)=>{this.socket=new a(this.apcModel.selectedApc.p+
ath);this.socket.attachMessage(t=>{this.apcLog.entries.push({participant:"Server",data:t.getParameters().data,timestamp:(new Date).toISOString()});this.refreshApcLog()});this.socket.attachOpen(()=>{this.apcModel.state="connected";t()});this.socket.attach+
Close(()=>{this.apcModel.state="disconnected"});this.socket.attachError(t=>{e(new Error("failed to connect: "+JSON.stringify(t)))})});this.focusFeedInput();s.show(this.component.getText("msg.apcConnected",[this.apcModel.selectedApc.path]))}catch(t){p.sho+
wError(t)}finally{this.setBusy(false)}},getById:function t(e){const s=this.fragmentId;const n=`${s}--${e}`;const o=i.byId(n);return o},refreshApcLog:function t(){this.getView()?.getModel("apcLog")?.refresh();this.getById("idLogTable").refreshAggregation(+
"items")},onPostMessageButtonPress:function t(e){this.apcLog.entries.push({participant:"Client",data:e.getParameters().value,timestamp:(new Date).toISOString()});this.socket?.send(e.getParameters().value);this.refreshApcLog();this.focusFeedInput()},focus+
FeedInput:function t(){this.getById("idFeedInput")?.focus()},setTitle:function t(e){throw new Error("Not implemented: "+e)}});return u});                                                                                                                      
//# sourceMappingURL=APC.controller.js.map                                                                                                                                                                                                                     