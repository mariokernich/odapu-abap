sap.ui.define(["sap/ui/model/odata/v2/ODataModel", "./ODataHelper", "sap/m/MessageBox", "./Util", "./SoundManager"], function (ODataModelV2, __ODataHelper, MessageBox, __Util, __SoundManager) {                                                              
  "use strict";                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
  function _interopRequireDefault(obj) {                                                                                                                                                                                                                       
    return obj && obj.__esModule && typeof obj.default !== "undefined" ? obj.default : obj;                                                                                                                                                                    
  }                                                                                                                                                                                                                                                            
  const ODataHelper = _interopRequireDefault(__ODataHelper);                                                                                                                                                                                                   
  const Util = _interopRequireDefault(__Util);                                                                                                                                                                                                                 
  const SoundManager = _interopRequireDefault(__SoundManager);                                                                                                                                                                                                 
  /**                                                                                                                                                                                                                                                          
   * @namespace de.kernich.odpu.util                                                                                                                                                                                                                           
   */                                                                                                                                                                                                                                                          
  class OData2Client {                                                                                                                                                                                                                                         
    constructor(serviceUrl) {                                                                                                                                                                                                                                  
      this.serviceUrl = serviceUrl;                                                                                                                                                                                                                            
      this.model = new ODataModelV2(serviceUrl, {});                                                                                                                                                                                                           
      this.model.attachRequestFailed({}, event => {                                                                                                                                                                                                            
        void SoundManager.FireError();                                                                                                                                                                                                                         
        const parameters = event.getParameters();                                                                                                                                                                                                              
        const responseText = parameters.response.responseText;                                                                                                                                                                                                 
        if (responseText.startsWith("<?xml")) {                                                                                                                                                                                                                
          // Handle XML response                                                                                                                                                                                                                               
          const parser = new DOMParser();                                                                                                                                                                                                                      
          const xmlDoc = parser.parseFromString(responseText, "text/xml");                                                                                                                                                                                     
          const messageNode = xmlDoc.getElementsByTagName("message")[0];                                                                                                                                                                                       
          if (messageNode) {                                                                                                                                                                                                                                   
            MessageBox.error(messageNode.textContent);                                                                                                                                                                                                         
          } else {                                                                                                                                                                                                                                             
            MessageBox.error("Unknown error occurred");                                                                                                                                                                                                        
          }                                                                                                                                                                                                                                                    
        } else {                                                                                                                                                                                                                                               
          // Handle JSON response                                                                                                                                                                                                                              
          const json = JSON.parse(responseText);                                                                                                                                                                                                               
          MessageBox.error(json.error.message.value);                                                                                                                                                                                                          
        }                                                                                                                                                                                                                                                      
      });                                                                                                                                                                                                                                                      
    }                                                                                                                                                                                                                                                          
    getActions() {                                                                                                                                                                                                                                             
      return [];                                                                                                                                                                                                                                               
    }                                                                                                                                                                                                                                                          
    getComplexTypes() {                                                                                                                                                                                                                                        
      const complexTypes = [];                                                                                                                                                                                                                                 
      const complexTypeNodes = Array.from(this.metadataXml?.getElementsByTagName("ComplexType") || []);                                                                                                                                                        
      for (const complexTypeNode of complexTypeNodes) {                                                                                                                                                                                                        
        const name = complexTypeNode.getAttribute("Name");                                                                                                                                                                                                     
        if (!name) continue;                                                                                                                                                                                                                                   
        const properties = Array.from(complexTypeNode.getElementsByTagName("Property")).map(propertyNode => ({                                                                                                                                                 
          name: propertyNode.getAttribute("Name") || "",                                                                                                                                                                                                       
          type: propertyNode.getAttribute("Type") || "",                                                                                                                                                                                                       
          nullable: propertyNode.getAttribute("Nullable") || "",                                                                                                                                                                                               
          maxLength: ODataHelper.getMaxLength(propertyNode.getAttribute("MaxLength") || "")                                                                                                                                                                    
        }));                                                                                                                                                                                                                                                   
        complexTypes.push({                                                                                                                                                                                                                                    
          name: name,                                                                                                                                                                                                                                          
          properties: properties                                                                                                                                                                                                                               
        });                                                                                                                                                                                                                                                    
      }                                                                                                                                                                                                                                                        
      return complexTypes.filter(entity => !entity.name.startsWith("SAP__"));                                                                                                                                                                                  
    }                                                                                                                                                                                                                                                          
    destroy() {}                                                                                                                                                                                                                                               
    async createEntity(options) {                                                                                                                                                                                                                              
      this.model.setHeaders(options.headers);                                                                                                                                                                                                                  
      await new Promise((resolve, reject) => {                                                                                                                                                                                                                 
        this.model.create(`/${options.entityName}`, options.properties, {                                                                                                                                                                                      
          success: () => resolve(),                                                                                                                                                                                                                            
          error: error => reject(error)                                                                                                                                                                                                                        
        });                                                                                                                                                                                                                                                    
      });                                                                                                                                                                                                                                                      
      await SoundManager.FireSuccess();                                                                                                                                                                                                                        
    }                                                                                                                                                                                                                                                          
    async getEntity(options) {                                                                                                                                                                                                                                 
      this.model.setHeaders(options.headers);                                                                                                                                                                                                                  
      const keyPath = Object.entries(options.keys).map(([key, value]) => `${key}='${value}'`).join(",");                                                                                                                                                       
      const urlParameters = {};                                                                                                                                                                                                                                
      if (options.expand && options.expand.length > 0) {                                                                                                                                                                                                       
        urlParameters.$expand = options.expand.join(',');                                                                                                                                                                                                      
      }                                                                                                                                                                                                                                                        
      const result = await new Promise((resolve, reject) => {                                                                                                                                                                                                  
        this.model.read(`/${options.entityName}(${keyPath})`, {                                                                                                                                                                                                
          success: data => {                                                                                                                                                                                                                                   
            resolve(data);                                                                                                                                                                                                                                     
          },                                                                                                                                                                                                                                                   
          error: error => {                                                                                                                                                                                                                                    
            reject(error);                                                                                                                                                                                                                                     
          },                                                                                                                                                                                                                                                   
          urlParameters: Object.keys(urlParameters).length > 0 ? urlParameters : undefined                                                                                                                                                                     
        });                                                                                                                                                                                                                                                    
      });                                                                                                                                                                                                                                                      
      await SoundManager.FireSuccess();                                                                                                                                                                                                                        
      return result;                                                                                                                                                                                                                                           
    }                                                                                                                                                                                                                                                          
    async deleteEntity(options) {                                                                                                                                                                                                                              
      this.model.setHeaders(options.headers);                                                                                                                                                                                                                  
      const path = this.model.createKey(`/${options.entityName}`, options.keys);                                                                                                                                                                               
      await new Promise((resolve, reject) => {                                                                                                                                                                                                                 
        this.model.remove(path, {                                                                                                                                                                                                                              
          success: () => resolve(),                                                                                                                                                                                                                            
          error: error => reject(error)                                                                                                                                                                                                                        
        });                                                                                                                                                                                                                                                    
      });                                                                                                                                                                                                                                                      
      await SoundManager.FireSuccess();                                                                                                                                                                                                                        
    }                                                                                                                                                                                                                                                          
    async initAsync() {                                                                                                                                                                                                                                        
      try {                                                                                                                                                                                                                                                    
        await this.model.metadataLoaded(true);                                                                                                                                                                                                                 
      } catch (error) {                                                                                                                                                                                                                                        
        MessageBox.error("Failed to load metadata of Service " + this.serviceUrl + ":\n\nPlease check Backend configuration and try again.", {                                                                                                                 
          details: Util.getErrorMessage(error)                                                                                                                                                                                                                 
        });                                                                                                                                                                                                                                                    
        throw error;                                                                                                                                                                                                                                           
      }                                                                                                                                                                                                                                                        
      this.metadataText = await ODataHelper.getMetadataText(this.serviceUrl);                                                                                                                                                                                  
      this.metadataXml = ODataHelper.parseMetadataXml(this.metadataText);                                                                                                                                                                                      
    }                                                                                                                                                                                                                                                          
    getEntities() {                                                                                                                                                                                                                                            
      const entities = [];                                                                                                                                                                                                                                     
      const entitySets = Array.from(this.metadataXml?.getElementsByTagName("EntitySet") || []).map(node => ({                                                                                                                                                  
        Name: node.getAttribute("Name"),                                                                                                                                                                                                                       
        EntityType: node.getAttribute("EntityType")                                                                                                                                                                                                            
      }));                                                                                                                                                                                                                                                     
      for (const entity of entitySets) {                                                                                                                                                                                                                       
        let entityType = entity.EntityType;                                                                                                                                                                                                                    
        if (entityType && entityType.includes(".")) {                                                                                                                                                                                                          
          entityType = entityType.split(".").pop();                                                                                                                                                                                                            
        }                                                                                                                                                                                                                                                      
        const entityTypeNode = Array.from(this.metadataXml?.getElementsByTagName("EntityType") || []).find(node => {                                                                                                                                           
          return node.getAttribute("Name") === entityType;                                                                                                                                                                                                     
        });                                                                                                                                                                                                                                                    
        if (!entityTypeNode) continue;                                                                                                                                                                                                                         
        const properties = Array.from(entityTypeNode.getElementsByTagName("Property")).map(propertyNode => ({                                                                                                                                                  
          name: propertyNode.getAttribute("Name") || "",                                                                                                                                                                                                       
          type: propertyNode.getAttribute("Type") || "",                                                                                                                                                                                                       
          nullable: propertyNode.getAttribute("Nullable") || "",                                                                                                                                                                                               
          maxLength: ODataHelper.getMaxLength(propertyNode.getAttribute("MaxLength") || "")                                                                                                                                                                    
        }));                                                                                                                                                                                                                                                   
        const keyNode = entityTypeNode.getElementsByTagName("Key")[0];                                                                                                                                                                                         
        const propertyRefs = keyNode ? Array.from(keyNode.getElementsByTagName("PropertyRef")).map(keyNode => {                                                                                                                                                
          const keyName = keyNode.getAttribute("Name") || "";                                                                                                                                                                                                  
          const prop = properties.find(property => property.name === keyName) || {                                                                                                                                                                             
            name: keyName,                                                                                                                                                                                                                                     
            type: '',                                                                                                                                                                                                                                          
            nullable: '',                                                                                                                                                                                                                                      
            maxLength: 0                                                                                                                                                                                                                                       
          };                                                                                                                                                                                                                                                   
          return {                                                                                                                                                                                                                                             
            name: prop.name,                                                                                                                                                                                                                                   
            type: prop.type,                                                                                                                                                                                                                                   
            nullable: prop.nullable,                                                                                                                                                                                                                           
            maxLength: prop.maxLength                                                                                                                                                                                                                          
          };                                                                                                                                                                                                                                                   
        }) : [];                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        // Parse NavigationProperties                                                                                                                                                                                                                          
        const navigationProperties = Array.from(entityTypeNode.getElementsByTagName("NavigationProperty")).map(navNode => ({                                                                                                                                   
          name: navNode.getAttribute("Name") || "",                                                                                                                                                                                                            
          relationship: navNode.getAttribute("Relationship") || "",                                                                                                                                                                                            
          fromRole: navNode.getAttribute("FromRole") || "",                                                                                                                                                                                                    
          toRole: navNode.getAttribute("ToRole") || ""                                                                                                                                                                                                         
        }));                                                                                                                                                                                                                                                   
        entities.push({                                                                                                                                                                                                                                        
          name: entity.Name || "",                                                                                                                                                                                                                             
          entityType: entityType || "",                                                                                                                                                                                                                        
          properties: properties,                                                                                                                                                                                                                              
          keys: propertyRefs,                                                                                                                                                                                                                                  
          navigationProperties: navigationProperties                                                                                                                                                                                                           
        });                                                                                                                                                                                                                                                    
      }                                                                                                                                                                                                                                                        
      return entities.filter(entity => !entity.name.startsWith("SAP__"));                                                                                                                                                                                      
    }                                                                                                                                                                                                                                                          
    getAssociations() {                                                                                                                                                                                                                                        
      const associations = [];                                                                                                                                                                                                                                 
      const associationNodes = Array.from(this.metadataXml?.getElementsByTagName("Association") || []);                                                                                                                                                        
      for (const assocNode of associationNodes) {                                                                                                                                                                                                              
        const name = assocNode.getAttribute("Name") || "";                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        // Ends                                                                                                                                                                                                                                                
        const endNodes = Array.from(assocNode.getElementsByTagName("End"));                                                                                                                                                                                    
        const end = endNodes.map(endNode => ({                                                                                                                                                                                                                 
          type: endNode.getAttribute("Type") || "",                                                                                                                                                                                                            
          multiplicity: endNode.getAttribute("Multiplicity") || "",                                                                                                                                                                                            
          role: endNode.getAttribute("Role") || "",                                                                                                                                                                                                            
          onDeleteAction: (() => {                                                                                                                                                                                                                             
            const onDelete = endNode.getElementsByTagName("OnDelete")[0];                                                                                                                                                                                      
            return onDelete ? onDelete.getAttribute("Action") || undefined : undefined;                                                                                                                                                                        
          })()                                                                                                                                                                                                                                                 
        }));                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
        // ReferentialConstraint                                                                                                                                                                                                                               
        const refConstraintNode = assocNode.getElementsByTagName("ReferentialConstraint")[0];                                                                                                                                                                  
        let referentialConstraint = undefined;                                                                                                                                                                                                                 
        if (refConstraintNode) {                                                                                                                                                                                                                               
          const principalNode = refConstraintNode.getElementsByTagName("Principal")[0];                                                                                                                                                                        
          const dependentNode = refConstraintNode.getElementsByTagName("Dependent")[0];                                                                                                                                                                        
          referentialConstraint = {                                                                                                                                                                                                                            
            principal: principalNode ? [{                                                                                                                                                                                                                      
              role: principalNode.getAttribute("Role") || "",                                                                                                                                                                                                  
              propertyRef: Array.from(principalNode.getElementsByTagName("PropertyRef")).map(pr => ({                                                                                                                                                          
                name: pr.getAttribute("Name") || ""                                                                                                                                                                                                            
              }))                                                                                                                                                                                                                                              
            }] : [],                                                                                                                                                                                                                                           
            dependent: {                                                                                                                                                                                                                                       
              role: dependentNode?.getAttribute("Role") || "",                                                                                                                                                                                                 
              propertyRef: dependentNode ? Array.from(dependentNode.getElementsByTagName("PropertyRef")).map(pr => ({                                                                                                                                          
                name: pr.getAttribute("Name") || ""                                                                                                                                                                                                            
              })) : []                                                                                                                                                                                                                                         
            }                                                                                                                                                                                                                                                  
          };                                                                                                                                                                                                                                                   
        }                                                                                                                                                                                                                                                      
        associations.push({                                                                                                                                                                                                                                    
          name,                                                                                                                                                                                                                                                
          end,                                                                                                                                                                                                                                                 
          referentialConstraint                                                                                                                                                                                                                                
        });                                                                                                                                                                                                                                                    
      }                                                                                                                                                                                                                                                        
      return associations;                                                                                                                                                                                                                                     
    }                                                                                                                                                                                                                                                          
    getMetadataText() {                                                                                                                                                                                                                                        
      return this.metadataText || "";                                                                                                                                                                                                                          
    }                                                                                                                                                                                                                                                          
    getMetadataXml() {                                                                                                                                                                                                                                         
      return this.metadataXml || new XMLDocument();                                                                                                                                                                                                            
    }                                                                                                                                                                                                                                                          
    getFunctions() {                                                                                                                                                                                                                                           
      const functionImports = Array.from(this.metadataXml?.getElementsByTagName("FunctionImport") || []).map(node => ({                                                                                                                                        
        Name: node.getAttribute("Name"),                                                                                                                                                                                                                       
        ReturnType: node.getAttribute("ReturnType"),                                                                                                                                                                                                           
        EntitySet: node.getAttribute("EntitySet"),                                                                                                                                                                                                             
        HttpMethod: node.getAttribute("m:HttpMethod"),                                                                                                                                                                                                         
        Parameters: Array.from(node.getElementsByTagName("Parameter")).map(paramNode => ({                                                                                                                                                                     
          name: paramNode.getAttribute("Name"),                                                                                                                                                                                                                
          type: paramNode.getAttribute("Type"),                                                                                                                                                                                                                
          nullable: paramNode.getAttribute("Nullable"),                                                                                                                                                                                                        
          maxLength: ODataHelper.getMaxLength(paramNode.getAttribute("MaxLength") || "")                                                                                                                                                                       
        }))                                                                                                                                                                                                                                                    
      }));                                                                                                                                                                                                                                                     
      return functionImports.map(func => ({                                                                                                                                                                                                                    
        name: func.Name,                                                                                                                                                                                                                                       
        returnType: func.ReturnType,                                                                                                                                                                                                                           
        entitySet: func.EntitySet,                                                                                                                                                                                                                             
        parameters: func.Parameters,                                                                                                                                                                                                                           
        method: func.HttpMethod                                                                                                                                                                                                                                
      }));                                                                                                                                                                                                                                                     
    }                                                                                                                                                                                                                                                          
    getModel() {                                                                                                                                                                                                                                               
      return this.model;                                                                                                                                                                                                                                       
    }                                                                                                                                                                                                                                                          
    async readEntity(options) {                                                                                                                                                                                                                                
      this.model.setHeaders(options.headers);                                                                                                                                                                                                                  
      const urlParameters = {                                                                                                                                                                                                                                  
        $top: options.top.toString(),                                                                                                                                                                                                                          
        $skip: options.skip.toString()                                                                                                                                                                                                                         
      };                                                                                                                                                                                                                                                       
      if (options.expand && options.expand.length > 0) {                                                                                                                                                                                                       
        urlParameters.$expand = options.expand.join(',');                                                                                                                                                                                                      
      }                                                                                                                                                                                                                                                        
      const result = await new Promise((resolve, reject) => {                                                                                                                                                                                                  
        this.model.read(`/${options.entityName}`, {                                                                                                                                                                                                            
          success: data => {                                                                                                                                                                                                                                   
            resolve(data);                                                                                                                                                                                                                                     
          },                                                                                                                                                                                                                                                   
          error: error => {                                                                                                                                                                                                                                    
            reject(error);                                                                                                                                                                                                                                     
          },                                                                                                                                                                                                                                                   
          filters: options.filters.length > 0 ? options.filters : undefined,                                                                                                                                                                                   
          sorters: options.sorting.length > 0 ? options.sorting : undefined,                                                                                                                                                                                   
          urlParameters: urlParameters                                                                                                                                                                                                                         
        });                                                                                                                                                                                                                                                    
      });                                                                                                                                                                                                                                                      
      await SoundManager.FireSuccess();                                                                                                                                                                                                                        
      return result;                                                                                                                                                                                                                                           
    }                                                                                                                                                                                                                                                          
    async executeFunction(options) {                                                                                                                                                                                                                           
      const result = await new Promise((resolve, reject) => {                                                                                                                                                                                                  
        this.model.callFunction(`/${options.functionName}`, {                                                                                                                                                                                                  
          urlParameters: options.parameters,                                                                                                                                                                                                                   
          method: options.method,                                                                                                                                                                                                                              
          success: data => resolve(data),                                                                                                                                                                                                                      
          error: error => reject(error)                                                                                                                                                                                                                        
        });                                                                                                                                                                                                                                                    
      });                                                                                                                                                                                                                                                      
      await SoundManager.FireSuccess();                                                                                                                                                                                                                        
      return result;                                                                                                                                                                                                                                           
    }                                                                                                                                                                                                                                                          
    executeAction(options) {                                                                                                                                                                                                                                   
      throw new Error("Not implemented: " + JSON.stringify(options));                                                                                                                                                                                          
    }                                                                                                                                                                                                                                                          
  }                                                                                                                                                                                                                                                            
  return OData2Client;                                                                                                                                                                                                                                         
});                                                                                                                                                                                                                                                            
//# sourceMappingURL=OData2Client-dbg.js.map                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               